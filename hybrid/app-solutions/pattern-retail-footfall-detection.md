---
title: Padrão de deteção de rodapé usando Azure e Azure Stack Hub
description: Saiba como usar o Azure e o Azure Stack Hub para implementar uma solução de deteção de pés baseada em IA para analisar o tráfego de lojas de retalho.
author: BryanLa
ms.topic: article
ms.date: 10/31/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 10/31/2019
ms.openlocfilehash: 0bf07bb38537f530a0adb3569c43d53af13b8d56
ms.sourcegitcommit: bb3e40b210f86173568a47ba18c3cc50d4a40607
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 06/17/2020
ms.locfileid: "84911223"
---
# <a name="footfall-detection-pattern"></a><span data-ttu-id="6f1e0-103">Padrão de deteção de rodapé</span><span class="sxs-lookup"><span data-stu-id="6f1e0-103">Footfall detection pattern</span></span>

<span data-ttu-id="6f1e0-104">Este padrão fornece uma visão geral para a implementação de uma solução de deteção de pés baseada em IA para analisar o tráfego de visitantes em lojas de retalho.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-104">This pattern provides an overview for implementing an AI-based footfall detection solution for analyzing visitor traffic in retail stores.</span></span> <span data-ttu-id="6f1e0-105">A solução gera insights de ações do mundo real, usando Azure Stack Hub e o Kit Dev Dev Visão Personalizada.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-105">The solution generates insights from real world actions, using Azure, Azure Stack Hub, and the Custom Vision AI Dev Kit.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="6f1e0-106">Contexto e problema</span><span class="sxs-lookup"><span data-stu-id="6f1e0-106">Context and problem</span></span>

<span data-ttu-id="6f1e0-107">A Contoso Stores gostaria de obter informações sobre como os clientes estão a receber os seus produtos atuais em relação ao layout da loja.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-107">Contoso Stores would like to gain insights on how customers are receiving their current products in relation to store layout.</span></span> <span data-ttu-id="6f1e0-108">Não conseguem colocar pessoal em todas as secções e é ineficiente que uma equipa de analistas reveja as filmagens de uma loja inteira.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-108">They're unable to place staff in every section and it's inefficient to have a team of analysts review an entire store's camera footage.</span></span> <span data-ttu-id="6f1e0-109">Além disso, nenhuma das suas lojas tem largura de banda suficiente para transmitir vídeos de todas as suas câmaras para a nuvem para análise.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-109">In addition, none of their stores have enough bandwidth to stream video from all their cameras to the cloud for analysis.</span></span>

<span data-ttu-id="6f1e0-110">A Contoso gostaria de encontrar uma forma discreta e amiga da privacidade de determinar a demografia, lealdade e reações dos seus clientes à loja de expositores e produtos.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-110">Contoso would like to find an unobtrusive, privacy-friendly way to determine their customers' demographics, loyalty, and reactions to store displays and products.</span></span>

## <a name="solution"></a><span data-ttu-id="6f1e0-111">Solução</span><span class="sxs-lookup"><span data-stu-id="6f1e0-111">Solution</span></span>

<span data-ttu-id="6f1e0-112">Este padrão de análise de retalho usa uma abordagem hierárquica para inferencing na borda.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-112">This retail analytics pattern uses a tiered approach to inferencing at the edge.</span></span> <span data-ttu-id="6f1e0-113">Ao utilizar o Kit Dev Dev Da Visão Personalizada, apenas imagens com rostos humanos são enviadas para análise para um Azure Stack Hub privado que gere os Serviços Cognitivos Azure.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-113">By using the Custom Vision AI Dev Kit, only images with human faces are sent for analysis to a private Azure Stack Hub that runs Azure Cognitive Services.</span></span> <span data-ttu-id="6f1e0-114">Dados anonimizados e agregados são enviados para a Azure para agregação em todas as lojas e visualização no Power BI.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-114">Anonymized, aggregated data is sent to Azure for aggregation across all stores and visualization in Power BI.</span></span> <span data-ttu-id="6f1e0-115">Combinar a borda e a nuvem pública permite que a Contoso aproveite a tecnologia moderna de IA, mantendo-se também em conformidade com as suas políticas corporativas e respeitando a privacidade dos seus clientes.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-115">Combining the edge and public cloud lets Contoso take advantage of modern AI technology while also remaining in compliance with their corporate policies and respecting their customers' privacy.</span></span>

<span data-ttu-id="6f1e0-116">[![Solução de padrão de deteção de rodapé](media/pattern-retail-footfall-detection/solution-architecture.png)](media/pattern-retail-footfall-detection/solution-architecture.png)</span><span class="sxs-lookup"><span data-stu-id="6f1e0-116">[![Footfall detection pattern solution](media/pattern-retail-footfall-detection/solution-architecture.png)](media/pattern-retail-footfall-detection/solution-architecture.png)</span></span>

<span data-ttu-id="6f1e0-117">Aqui está um resumo de como a solução funciona:</span><span class="sxs-lookup"><span data-stu-id="6f1e0-117">Here's a summary of how the solution works:</span></span>

1. <span data-ttu-id="6f1e0-118">O Kit Dev Dev Visão Personalizada obtém uma configuração do IoT Hub, que instala o IoT Edge Runtime e um modelo ML.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-118">The Custom Vision AI Dev Kit gets a configuration from IoT Hub, which installs the IoT Edge Runtime and an ML model.</span></span>
2. <span data-ttu-id="6f1e0-119">Se o modelo vir uma pessoa, tira uma fotografia e envia-a para o armazenamento de blob Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-119">If the model sees a person, it takes a picture and uploads it to Azure Stack Hub blob storage.</span></span>
3. <span data-ttu-id="6f1e0-120">O serviço blob aciona uma função Azure no Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-120">The blob service triggers an Azure Function on Azure Stack Hub.</span></span>
4. <span data-ttu-id="6f1e0-121">A Função Azure chama um recipiente com a API facial para obter dados demográficos e de emoção da imagem.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-121">The Azure Function calls a container with the Face API to get demographic and emotion data from the image.</span></span>
5. <span data-ttu-id="6f1e0-122">Os dados são anonimizados e enviados para um cluster Azure Event Hubs.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-122">The data is anonymized and sent to an Azure Event Hubs cluster.</span></span>
6. <span data-ttu-id="6f1e0-123">O cluster Event Hubs empurra os dados para stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-123">The Event Hubs cluster pushes the data to Stream Analytics.</span></span>
7. <span data-ttu-id="6f1e0-124">Stream Analytics agrega os dados e empurra-os para o Power BI.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-124">Stream Analytics aggregates the data and pushes it to Power BI.</span></span>

## <a name="components"></a><span data-ttu-id="6f1e0-125">Componentes</span><span class="sxs-lookup"><span data-stu-id="6f1e0-125">Components</span></span>

<span data-ttu-id="6f1e0-126">Esta solução utiliza os seguintes componentes:</span><span class="sxs-lookup"><span data-stu-id="6f1e0-126">This solution uses the following components:</span></span>

| <span data-ttu-id="6f1e0-127">Camada</span><span class="sxs-lookup"><span data-stu-id="6f1e0-127">Layer</span></span> | <span data-ttu-id="6f1e0-128">Componente</span><span class="sxs-lookup"><span data-stu-id="6f1e0-128">Component</span></span> | <span data-ttu-id="6f1e0-129">Description</span><span class="sxs-lookup"><span data-stu-id="6f1e0-129">Description</span></span> |
|----------|-----------|-------------|
| <span data-ttu-id="6f1e0-130">Hardware na loja</span><span class="sxs-lookup"><span data-stu-id="6f1e0-130">In-store hardware</span></span> | [<span data-ttu-id="6f1e0-131">Kit de visão AI Dev personalizado</span><span class="sxs-lookup"><span data-stu-id="6f1e0-131">Custom Vision AI Dev Kit</span></span>](https://azure.github.io/Vision-AI-DevKit-Pages/) | <span data-ttu-id="6f1e0-132">Fornece filtragem na loja usando um modelo ML local que apenas captura imagens de pessoas para análise.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-132">Provides in-store filtering using a local ML model that only captures images of people for analysis.</span></span> <span data-ttu-id="6f1e0-133">A provisionada e atualizada de forma segura através do IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-133">Securely provisioned and updated through IoT Hub.</span></span><br><br>|
| <span data-ttu-id="6f1e0-134">Azure</span><span class="sxs-lookup"><span data-stu-id="6f1e0-134">Azure</span></span> | [<span data-ttu-id="6f1e0-135">Azure Event Hubs</span><span class="sxs-lookup"><span data-stu-id="6f1e0-135">Azure Event Hubs</span></span>](/azure/event-hubs/) | <span data-ttu-id="6f1e0-136">O Azure Event Hubs fornece uma plataforma escalável para ingerir dados anonimizados que se integram perfeitamente com o Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-136">Azure Event Hubs provides a scalable platform for ingesting anonymized data that integrates neatly with Azure Stream Analytics.</span></span> |
|  | [<span data-ttu-id="6f1e0-137">Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="6f1e0-137">Azure Stream Analytics</span></span>](/azure/stream-analytics/) | <span data-ttu-id="6f1e0-138">Um trabalho do Azure Stream Analytics agrega os dados anonimizados e agrupe-os em janelas de 15 segundos para visualização.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-138">An Azure Stream Analytics job aggregates the anonymized data and groups it into 15-second windows for visualization.</span></span> |
|  | [<span data-ttu-id="6f1e0-139">Microsoft Power BI</span><span class="sxs-lookup"><span data-stu-id="6f1e0-139">Microsoft Power BI</span></span>](https://powerbi.microsoft.com/) | <span data-ttu-id="6f1e0-140">O Power BI fornece uma interface de painel fácil de usar para visualizar a saída do Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-140">Power BI provides an easy-to-use dashboard interface for viewing the output from Azure Stream Analytics.</span></span> |
| <span data-ttu-id="6f1e0-141">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="6f1e0-141">Azure Stack Hub</span></span> | [<span data-ttu-id="6f1e0-142">Serviço de Aplicações</span><span class="sxs-lookup"><span data-stu-id="6f1e0-142">App Service</span></span>](/azure-stack/operator/azure-stack-app-service-overview.md) | <span data-ttu-id="6f1e0-143">O fornecedor de recursos do Serviço de Aplicações (RP) fornece uma base para componentes de borda, incluindo funcionalidades de hospedagem e gestão para aplicações web/APIs e Funções.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-143">The App Service resource provider (RP) provides a base for edge components, including hosting and management features for web apps/APIs and Functions.</span></span> |
| | <span data-ttu-id="6f1e0-144">Cluster de motor de serviço Azure Kubernetes [(AKS)](https://github.com/Azure/aks-engine)</span><span class="sxs-lookup"><span data-stu-id="6f1e0-144">Azure Kubernetes Service [(AKS) Engine](https://github.com/Azure/aks-engine) cluster</span></span> | <span data-ttu-id="6f1e0-145">O AKS RP com cluster AKS-Engine implantado no Azure Stack Hub fornece um motor escalável e resistente para executar o recipiente Face API.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-145">The AKS RP with AKS-Engine cluster deployed into Azure Stack Hub provides a scalable, resilient engine to run the Face API container.</span></span> |
| | <span data-ttu-id="6f1e0-146">Serviços Cognitivos Azure [enfrentam recipientes de API](/azure/cognitive-services/face/face-how-to-install-containers)</span><span class="sxs-lookup"><span data-stu-id="6f1e0-146">Azure Cognitive Services [Face API containers](/azure/cognitive-services/face/face-how-to-install-containers)</span></span>| <span data-ttu-id="6f1e0-147">O Azure Cognitive Services RP com recipientes face API fornece deteção demográfica, emoção e visitante único na rede privada de Contoso.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-147">The Azure Cognitive Services RP with Face API containers provides demographic, emotion, and unique visitor detection on Contoso's private network.</span></span> |
| | <span data-ttu-id="6f1e0-148">Blob Storage</span><span class="sxs-lookup"><span data-stu-id="6f1e0-148">Blob Storage</span></span> | <span data-ttu-id="6f1e0-149">As imagens captadas no Kit AI Dev são enviadas para o armazenamento de bolhas do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-149">Images captured from the AI Dev Kit are uploaded to Azure Stack Hub's blob storage.</span></span> |
| | <span data-ttu-id="6f1e0-150">Funções do Azure</span><span class="sxs-lookup"><span data-stu-id="6f1e0-150">Azure Functions</span></span> | <span data-ttu-id="6f1e0-151">Uma Função Azure em execução no Azure Stack Hub recebe a entrada do armazenamento de bolhas e gere as interações com a API face.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-151">An Azure Function running on Azure Stack Hub receives input from blob storage and manages the interactions with the Face API.</span></span> <span data-ttu-id="6f1e0-152">Emite dados anonimizados para um cluster de Centros de Eventos localizado em Azure.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-152">It emits anonymized data to an Event Hubs cluster located in Azure.</span></span><br><br>|

## <a name="issues-and-considerations"></a><span data-ttu-id="6f1e0-153">Problemas e considerações</span><span class="sxs-lookup"><span data-stu-id="6f1e0-153">Issues and considerations</span></span>

<span data-ttu-id="6f1e0-154">Considere os seguintes pontos ao decidir como implementar esta solução:</span><span class="sxs-lookup"><span data-stu-id="6f1e0-154">Consider the following points when deciding how to implement this solution:</span></span>

### <a name="scalability"></a><span data-ttu-id="6f1e0-155">Escalabilidade</span><span class="sxs-lookup"><span data-stu-id="6f1e0-155">Scalability</span></span>

<span data-ttu-id="6f1e0-156">Para permitir que esta solução seja dimensionada em várias câmaras e locais, terá de se certificar de que todos os componentes conseguem lidar com a carga aumentada.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-156">To enable this solution to scale across multiple cameras and locations, you'll need to make sure that all of the components can handle the increased load.</span></span> <span data-ttu-id="6f1e0-157">Pode ter de tomar ações como:</span><span class="sxs-lookup"><span data-stu-id="6f1e0-157">You may need to take actions like:</span></span>

- <span data-ttu-id="6f1e0-158">Aumente o número de unidades de streaming Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-158">Increase the number of Stream Analytics streaming units.</span></span>
- <span data-ttu-id="6f1e0-159">Dimensione a implantação da API face.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-159">Scale out the Face API deployment.</span></span>
- <span data-ttu-id="6f1e0-160">Aumente a produção do cluster Event Hubs.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-160">Increase the Event Hubs cluster throughput.</span></span>
- <span data-ttu-id="6f1e0-161">Para casos extremos, pode ser necessário migrar de Azure Functions para uma máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-161">For extreme cases, migrate from Azure Functions to a virtual machine may be necessary.</span></span>

### <a name="availability"></a><span data-ttu-id="6f1e0-162">Disponibilidade</span><span class="sxs-lookup"><span data-stu-id="6f1e0-162">Availability</span></span>

<span data-ttu-id="6f1e0-163">Uma vez que esta solução é hierárquico, é importante pensar em como lidar com falhas de rede ou de energia.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-163">Since this solution is tiered, it's important to think about how to deal with networking or power failures.</span></span> <span data-ttu-id="6f1e0-164">Dependendo das necessidades do negócio, pode querer implementar um mecanismo para cache de imagens localmente e, em seguida, encaminhar para o Azure Stack Hub quando a conectividade voltar.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-164">Depending on business needs, you might want to implement a mechanism to cache images locally, then forward to Azure Stack Hub when connectivity returns.</span></span> <span data-ttu-id="6f1e0-165">Se a localização for suficientemente grande, a implantação de uma Borda de Caixa de Dados com o recipiente API face para esse local pode ser uma opção melhor.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-165">If the location is large enough, deploying a Data Box Edge with the Face API container to that location might be a better option.</span></span>

### <a name="manageability"></a><span data-ttu-id="6f1e0-166">Capacidade de gestão</span><span class="sxs-lookup"><span data-stu-id="6f1e0-166">Manageability</span></span>

<span data-ttu-id="6f1e0-167">Esta solução pode abranger muitos dispositivos e locais, o que pode ficar instável.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-167">This solution can span many devices and locations, which could get unwieldy.</span></span> <span data-ttu-id="6f1e0-168">[Os serviços IoT da Azure](/azure/iot-fundamentals/) podem ser usados para automaticamente trazer novos locais e dispositivos on-line e mantê-los atualizados.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-168">[Azure's IoT services](/azure/iot-fundamentals/) can be used to automatically bring new locations and devices online and keep them up to date.</span></span>

### <a name="security"></a><span data-ttu-id="6f1e0-169">Segurança</span><span class="sxs-lookup"><span data-stu-id="6f1e0-169">Security</span></span>

<span data-ttu-id="6f1e0-170">Esta solução captura imagens do cliente, tornando a segurança uma consideração primordial.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-170">This solution captures customer images, making security a paramount consideration.</span></span> <span data-ttu-id="6f1e0-171">Certifique-se de que todas as contas de armazenamento estão seguras com as políticas de acesso adequadas e rode regularmente as teclas.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-171">Make sure all storage accounts are secured with the proper access policies and rotate keys regularly.</span></span> <span data-ttu-id="6f1e0-172">Garantir que as contas de armazenamento e os Centros de Eventos têm políticas de retenção que cumprem os regulamentos de privacidade corporativos e governamentais.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-172">Ensure storage accounts and Event Hubs have retention policies that meet corporate and government privacy regulations.</span></span> <span data-ttu-id="6f1e0-173">Certifique-se também de que nivela os níveis de acesso ao utilizador.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-173">Also make sure to tier the user access levels.</span></span> <span data-ttu-id="6f1e0-174">O tiering garante que os utilizadores apenas têm acesso aos dados de que necessitam para o seu papel.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-174">Tiering ensures that users only have access to the data they need for their role.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6f1e0-175">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="6f1e0-175">Next steps</span></span>

<span data-ttu-id="6f1e0-176">Para saber mais sobre os tópicos introduzidos neste artigo:</span><span class="sxs-lookup"><span data-stu-id="6f1e0-176">To learn more about the topics introduced in this article:</span></span>

- <span data-ttu-id="6f1e0-177">Consulte o [padrão de dados tiered,](https://aka.ms/tiereddatadeploy)que é alavancado pelo padrão de deteção de pés.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-177">See the [Tiered Data pattern](https://aka.ms/tiereddatadeploy), which is leveraged by the footfall detection pattern.</span></span>
- <span data-ttu-id="6f1e0-178">Consulte o [Kit Dev Dev Da Visão Personalizada](https://azure.github.io/Vision-AI-DevKit-Pages/) para saber mais sobre a utilização da visão personalizada.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-178">See the [Custom Vision AI Dev Kit](https://azure.github.io/Vision-AI-DevKit-Pages/) to learn more about using custom vision.</span></span> 

<span data-ttu-id="6f1e0-179">Quando estiver pronto para testar o exemplo da solução, continue com o [guia de deteção de footfall](solution-deployment-guide-retail-footfall-detection.md).</span><span class="sxs-lookup"><span data-stu-id="6f1e0-179">When you're ready to test the solution example, continue with the [Footfall detection deployment guide](solution-deployment-guide-retail-footfall-detection.md).</span></span> <span data-ttu-id="6f1e0-180">O guia de implantação fornece instruções passo a passo para a implantação e teste dos seus componentes.</span><span class="sxs-lookup"><span data-stu-id="6f1e0-180">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>
