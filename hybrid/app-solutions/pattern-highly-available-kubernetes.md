---
title: Padrão kubernetes de alta disponibilidade usando Azure e Azure Stack Hub
description: Saiba como uma solução de cluster Kubernetes proporciona alta disponibilidade usando O Azure e Azure Stack Hub.
author: BryanLa
ms.topic: article
ms.date: 12/03/2020
ms.author: bryanla
ms.reviewer: bryanla
ms.lastreviewed: 12/03/2020
ms.openlocfilehash: 454cc0a0531882b7a8ec050a461420ce13eebcfe
ms.sourcegitcommit: df7e3e6423c3d4e8a42dae3d1acfba1d55057258
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 12/09/2020
ms.locfileid: "96911794"
---
# <a name="high-availability-kubernetes-cluster-pattern"></a><span data-ttu-id="c71e4-103">Padrão de cluster kubernetes de alta disponibilidade</span><span class="sxs-lookup"><span data-stu-id="c71e4-103">High availability Kubernetes cluster pattern</span></span>

<span data-ttu-id="c71e4-104">Este artigo descreve como arquiteto e operar uma infraestrutura altamente disponível baseada em Kubernetes usando o motor do Serviço Azure Kubernetes (AKS) no Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-104">This article describes how to architect and operate a highly available Kubernetes-based infrastructure using Azure Kubernetes Service (AKS) Engine on Azure Stack Hub.</span></span> <span data-ttu-id="c71e4-105">Este cenário é comum para organizações com cargas de trabalho críticas em ambientes altamente restritos e regulamentados.</span><span class="sxs-lookup"><span data-stu-id="c71e4-105">This scenario is common for organizations with critical workloads in highly restricted and regulated environments.</span></span> <span data-ttu-id="c71e4-106">Organizações em domínios como finanças, defesa e governo.</span><span class="sxs-lookup"><span data-stu-id="c71e4-106">Organizations in domains such as finance, defense, and government.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="c71e4-107">Contexto e problema</span><span class="sxs-lookup"><span data-stu-id="c71e4-107">Context and problem</span></span>

<span data-ttu-id="c71e4-108">Muitas organizações estão a desenvolver soluções nativas em nuvem que alavancam serviços e tecnologias de última geração como kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-108">Many organizations are developing cloud-native solutions that leverage state-of-the-art services and technologies like Kubernetes.</span></span> <span data-ttu-id="c71e4-109">Embora a Azure forneça centros de dados na maioria das regiões do mundo, por vezes existem casos e cenários de utilização de bordas onde as aplicações críticas empresariais devem funcionar num local específico.</span><span class="sxs-lookup"><span data-stu-id="c71e4-109">Although Azure provides datacenters in most regions of the world, sometimes there are edge use-cases and scenarios where business critical applications must run in a specific location.</span></span> <span data-ttu-id="c71e4-110">Considerações incluem:</span><span class="sxs-lookup"><span data-stu-id="c71e4-110">Considerations include:</span></span>

- <span data-ttu-id="c71e4-111">Sensibilidade à localização</span><span class="sxs-lookup"><span data-stu-id="c71e4-111">Location sensitivity</span></span>
- <span data-ttu-id="c71e4-112">Latência entre os sistemas de aplicação e de instalação</span><span class="sxs-lookup"><span data-stu-id="c71e4-112">Latency between the application and on-premises systems</span></span>
- <span data-ttu-id="c71e4-113">Conservação da largura de banda</span><span class="sxs-lookup"><span data-stu-id="c71e4-113">Bandwidth conservation</span></span>
- <span data-ttu-id="c71e4-114">Conectividade</span><span class="sxs-lookup"><span data-stu-id="c71e4-114">Connectivity</span></span>
- <span data-ttu-id="c71e4-115">Requisitos regulamentares ou legais</span><span class="sxs-lookup"><span data-stu-id="c71e4-115">Regulatory or statutory requirements</span></span>

<span data-ttu-id="c71e4-116">Azure, em combinação com o Azure Stack Hub, aborda a maioria destas preocupações.</span><span class="sxs-lookup"><span data-stu-id="c71e4-116">Azure, in combination with Azure Stack Hub, addresses most of these concerns.</span></span> <span data-ttu-id="c71e4-117">Um vasto conjunto de opções, decisões e considerações para uma implementação bem sucedida de Kubernetes em execução no Azure Stack Hub é descrito abaixo.</span><span class="sxs-lookup"><span data-stu-id="c71e4-117">A broad set of options, decisions, and considerations for a successful implementation of Kubernetes running on Azure Stack Hub is described below.</span></span>

## <a name="solution"></a><span data-ttu-id="c71e4-118">Solução</span><span class="sxs-lookup"><span data-stu-id="c71e4-118">Solution</span></span>

<span data-ttu-id="c71e4-119">Este padrão pressupõe que temos de lidar com um conjunto rigoroso de restrições.</span><span class="sxs-lookup"><span data-stu-id="c71e4-119">This pattern assumes that we have to deal with a strict set of constraints.</span></span> <span data-ttu-id="c71e4-120">A aplicação deve ser executada no local e todos os dados pessoais não devem chegar aos serviços públicos em nuvem.</span><span class="sxs-lookup"><span data-stu-id="c71e4-120">The application must run on-premises and all personal data must not reach public cloud services.</span></span> <span data-ttu-id="c71e4-121">A monitorização e outros dados não PII podem ser enviados para a Azure e ser processados lá.</span><span class="sxs-lookup"><span data-stu-id="c71e4-121">Monitoring and other non-PII data can be sent to Azure and be processed there.</span></span> <span data-ttu-id="c71e4-122">Serviços externos como um registo público de contentores ou outros podem ser acedidos, mas podem ser filtrados através de uma firewall ou servidor de procuração.</span><span class="sxs-lookup"><span data-stu-id="c71e4-122">External services like a public Container Registry or others can be accessed but might be filtered through a firewall or proxy server.</span></span>

<span data-ttu-id="c71e4-123">A aplicação da amostra aqui apresentada (com base no [Azure Kubernetes Service Workshop](/learn/modules/aks-workshop/)) foi concebida para utilizar soluções nativas de Kubernetes sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="c71e4-123">The sample application shown here (based on [Azure Kubernetes Service Workshop](/learn/modules/aks-workshop/)) is designed to use Kubernetes-native solutions whenever possible.</span></span> <span data-ttu-id="c71e4-124">Este design evita o bloqueio do fornecedor, em vez de utilizar serviços nativos da plataforma.</span><span class="sxs-lookup"><span data-stu-id="c71e4-124">This design avoids vendor lock-in, instead of using platform-native services.</span></span> <span data-ttu-id="c71e4-125">Como exemplo, a aplicação utiliza uma base de dados mongoDB auto-hospedada em vez de um serviço PaaS ou serviço de base de dados externo.</span><span class="sxs-lookup"><span data-stu-id="c71e4-125">As an example, the application uses a self-hosted MongoDB database backend instead of a PaaS service or external database service.</span></span>

<span data-ttu-id="c71e4-126">[![Híbrido de padrão de aplicação](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="c71e4-126">[![Application Pattern Hybrid](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span></span>

<span data-ttu-id="c71e4-127">O diagrama anterior ilustra a arquitetura de aplicação da aplicação da amostra em execução em Kubernetes no Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-127">The preceding diagram illustrates the application architecture of the sample application running on Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="c71e4-128">A aplicação é composta por vários componentes, incluindo:</span><span class="sxs-lookup"><span data-stu-id="c71e4-128">The app consists of several components, including:</span></span>

 1) <span data-ttu-id="c71e4-129">Um cluster Kubernetes baseado em motor AKS no Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-129">An AKS Engine based Kubernetes cluster on Azure Stack Hub.</span></span>
 2) <span data-ttu-id="c71e4-130">[cert-manager](https://www.jetstack.io/cert-manager/), que fornece um conjunto de ferramentas para a gestão de certificados em Kubernetes, usado para solicitar automaticamente certificados da Let's Encrypt.</span><span class="sxs-lookup"><span data-stu-id="c71e4-130">[cert-manager](https://www.jetstack.io/cert-manager/), which provides a suite of tools for certificate management in Kubernetes, used to automatically request certificates from Let's Encrypt.</span></span>
 3) <span data-ttu-id="c71e4-131">Um espaço de nomes Kubernetes que contém os componentes da aplicação para a extremidade frontal (ratings-web), api (ratings-api) e base de dados (ratings-mongodb).</span><span class="sxs-lookup"><span data-stu-id="c71e4-131">A Kubernetes namespace that contains the application components for the front end (ratings-web), api (ratings-api), and database (ratings-mongodb).</span></span>
 4) <span data-ttu-id="c71e4-132">O Controlador Ingress que encaminha o tráfego HTTP/HTTPS para pontos finais dentro do cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-132">The Ingress Controller that routes HTTP/HTTPS traffic to endpoints within the Kubernetes cluster.</span></span>

<span data-ttu-id="c71e4-133">A aplicação da amostra é usada para ilustrar a arquitetura da aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-133">The sample application is used to illustrate the application architecture.</span></span> <span data-ttu-id="c71e4-134">Todos os componentes são exemplos.</span><span class="sxs-lookup"><span data-stu-id="c71e4-134">All components are examples.</span></span> <span data-ttu-id="c71e4-135">A arquitetura contém apenas uma aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-135">The architecture contains only a single application deployment.</span></span> <span data-ttu-id="c71e4-136">Para obter uma elevada disponibilidade (HA), executaremos a implementação pelo menos duas vezes em duas instâncias diferentes do Azure Stack Hub - eles podem correr no mesmo local ou em dois (ou mais) sites diferentes:</span><span class="sxs-lookup"><span data-stu-id="c71e4-136">To achieve high availability (HA), we'll run the deployment at least twice on two different Azure Stack Hub instances - they can run either in the same location or in two (or more) different sites:</span></span>

![Arquitetura de Infraestruturas](media/pattern-highly-available-kubernetes/aks-azure-architecture.png)

<span data-ttu-id="c71e4-138">Serviços como o Registo de Contentores Azure, Azure Monitor, entre outros, estão hospedados fora do Azure Stack Hub em Azure ou no local.</span><span class="sxs-lookup"><span data-stu-id="c71e4-138">Services like Azure Container Registry, Azure Monitor, and others, are hosted outside Azure Stack Hub in Azure or on-premises.</span></span> <span data-ttu-id="c71e4-139">Este design híbrido protege a solução contra a interrupção de uma única instância do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-139">This hybrid design protects the solution against outage of a single Azure Stack Hub instance.</span></span>

## <a name="components"></a><span data-ttu-id="c71e4-140">Componentes</span><span class="sxs-lookup"><span data-stu-id="c71e4-140">Components</span></span>

<span data-ttu-id="c71e4-141">A arquitetura global consiste nos seguintes componentes:</span><span class="sxs-lookup"><span data-stu-id="c71e4-141">The overall architecture consists of the following components:</span></span>

<span data-ttu-id="c71e4-142">**O Azure Stack Hub** é uma extensão do Azure que pode executar cargas de trabalho num ambiente no local, fornecendo serviços Azure no seu datacenter.</span><span class="sxs-lookup"><span data-stu-id="c71e4-142">**Azure Stack Hub** is an extension of Azure that can run workloads in an on-premises environment by providing Azure services in your datacenter.</span></span> <span data-ttu-id="c71e4-143">Vá ao [Azure Stack Hub para](/azure-stack/operator/azure-stack-overview) saber mais.</span><span class="sxs-lookup"><span data-stu-id="c71e4-143">Go to [Azure Stack Hub overview](/azure-stack/operator/azure-stack-overview) to learn more.</span></span>

<span data-ttu-id="c71e4-144">**Azure Kubernetes Service Engine (Motor AKS)** é o motor por detrás da oferta de serviços gerida da Kubernetes, a Azure Kubernetes Service (AKS), que está disponível hoje em Azure.</span><span class="sxs-lookup"><span data-stu-id="c71e4-144">**Azure Kubernetes Service Engine (AKS Engine)** is the engine behind the managed Kubernetes service offering, Azure Kubernetes Service (AKS), that is available in Azure today.</span></span> <span data-ttu-id="c71e4-145">Para o Azure Stack Hub, o Motor AKS permite-nos implementar, escalar e atualizar clusters Kubernetes totalmente apresentados e auto-geridos utilizando as capacidades iaaS do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-145">For Azure Stack Hub, AKS Engine allows us to deploy, scale, and upgrade fully featured, self-managed Kubernetes clusters using Azure Stack Hub's IaaS capabilities.</span></span> <span data-ttu-id="c71e4-146">Vá à [visão geral do motor AKS](https://github.com/Azure/aks-engine) para saber mais.</span><span class="sxs-lookup"><span data-stu-id="c71e4-146">Go to [AKS Engine Overview](https://github.com/Azure/aks-engine) to learn more.</span></span>

<span data-ttu-id="c71e4-147">Vá a [Questões e Limitações Conhecidas](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) para saber mais sobre as diferenças entre o motor AKS em Azure e o motor AKS no Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-147">Go to [Known Issues and Limitations](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) to learn more about the differences between AKS Engine on Azure and AKS Engine on Azure Stack Hub.</span></span>

<span data-ttu-id="c71e4-148">**A Azure Virtual Network (VNet)** é usada para fornecer a infraestrutura de rede em cada Azure Stack Hub para as Máquinas Virtuais (VMs) que hospedam a infraestrutura de cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-148">**Azure Virtual Network (VNet)** is used to provide the network infrastructure on each Azure Stack Hub for the Virtual Machines (VMs) hosting the Kubernetes cluster infrastructure.</span></span>

<span data-ttu-id="c71e4-149">**O Azure Load Balancer** é utilizado para o Ponto final da API de Kubernetes e para o Controlador Nginx Ingress.</span><span class="sxs-lookup"><span data-stu-id="c71e4-149">**Azure Load Balancer** is used for the Kubernetes API Endpoint and the Nginx Ingress Controller.</span></span> <span data-ttu-id="c71e4-150">O equilibrador de carga encaminha o tráfego externo (por exemplo, Internet) para nós e VMs oferecendo um serviço específico.</span><span class="sxs-lookup"><span data-stu-id="c71e4-150">The load balancer routes external (for example, Internet) traffic to nodes and VMs offering a specific service.</span></span>

<span data-ttu-id="c71e4-151">**O Registo de Contentores Azure (ACR)** é utilizado para armazenar imagens privadas do Docker e gráficos helm, que são implantados no cluster.</span><span class="sxs-lookup"><span data-stu-id="c71e4-151">**Azure Container Registry (ACR)** is used to store private Docker images and Helm charts, which are deployed to the cluster.</span></span> <span data-ttu-id="c71e4-152">O motor AKS pode autenticar-se com o registo do contentor utilizando uma identidade AD AZure.</span><span class="sxs-lookup"><span data-stu-id="c71e4-152">AKS Engine can authenticate with the Container Registry using an Azure AD identity.</span></span> <span data-ttu-id="c71e4-153">Kubernetes não requer ACR.</span><span class="sxs-lookup"><span data-stu-id="c71e4-153">Kubernetes doesn't require ACR.</span></span> <span data-ttu-id="c71e4-154">Pode utilizar outros registos de contentores, como o Docker Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-154">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="c71e4-155">**Azure Repos** é um conjunto de ferramentas de controlo de versão que pode utilizar para gerir o seu código.</span><span class="sxs-lookup"><span data-stu-id="c71e4-155">**Azure Repos** is a set of version control tools that you can use to manage your code.</span></span> <span data-ttu-id="c71e4-156">Você também pode usar GitHub ou outros repositórios baseados em git.</span><span class="sxs-lookup"><span data-stu-id="c71e4-156">You can also use GitHub or other git-based repositories.</span></span> <span data-ttu-id="c71e4-157">Vá ao [Azure Repos Overview](/azure/devops/repos/get-started/what-is-repos) para saber mais.</span><span class="sxs-lookup"><span data-stu-id="c71e4-157">Go to [Azure Repos Overview](/azure/devops/repos/get-started/what-is-repos) to learn more.</span></span>

<span data-ttu-id="c71e4-158">**A Azure Pipelines** faz parte da Azure DevOps Services e executa construções, testes e implementações automatizadas.</span><span class="sxs-lookup"><span data-stu-id="c71e4-158">**Azure Pipelines** is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="c71e4-159">Também pode utilizar soluções ci/CD de terceiros, como o Jenkins.</span><span class="sxs-lookup"><span data-stu-id="c71e4-159">You can also use third-party CI/CD solutions such as Jenkins.</span></span> <span data-ttu-id="c71e4-160">Vá ao [Azure Pipeline Overview](/azure/devops/pipelines/get-started/what-is-azure-pipelines) para saber mais.</span><span class="sxs-lookup"><span data-stu-id="c71e4-160">Go to [Azure Pipeline Overview](/azure/devops/pipelines/get-started/what-is-azure-pipelines) to learn more.</span></span>

<span data-ttu-id="c71e4-161">**O Azure Monitor** recolhe e armazena métricas e registos, incluindo métricas de plataforma para os serviços Azure na solução e telemetria de aplicações.</span><span class="sxs-lookup"><span data-stu-id="c71e4-161">**Azure Monitor** collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="c71e4-162">Utilize estes dados para monitorizar a aplicação, configurar alertas e dashboards e realizar a análise de causa raiz de falhas.</span><span class="sxs-lookup"><span data-stu-id="c71e4-162">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="c71e4-163">O Azure Monitor integra-se com Kubernetes para recolher métricas de controladores, nós e contentores, bem como troncos de contentores e troncos de nó master.</span><span class="sxs-lookup"><span data-stu-id="c71e4-163">Azure Monitor integrates with Kubernetes to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span> <span data-ttu-id="c71e4-164">Vá ao [Azure Monitor Overview](/azure/azure-monitor/overview) para saber mais.</span><span class="sxs-lookup"><span data-stu-id="c71e4-164">Go to [Azure Monitor Overview](/azure/azure-monitor/overview) to learn more.</span></span>

<span data-ttu-id="c71e4-165">**O Azure Traffic Manager** é um equilibrador de carga baseado em DNS que lhe permite distribuir o tráfego da melhor forma para serviços em diferentes regiões do Azure ou implementações do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-165">**Azure Traffic Manager** is a DNS-based traffic load balancer that enables you to distribute traffic optimally to services across different Azure regions or Azure Stack Hub deployments.</span></span> <span data-ttu-id="c71e4-166">O Gestor de Tráfego também fornece alta disponibilidade e capacidade de resposta.</span><span class="sxs-lookup"><span data-stu-id="c71e4-166">Traffic Manager also provides high availability and responsiveness.</span></span> <span data-ttu-id="c71e4-167">Os pontos finais da aplicação devem estar acessíveis a partir do exterior.</span><span class="sxs-lookup"><span data-stu-id="c71e4-167">The application endpoints must be accessible from the outside.</span></span> <span data-ttu-id="c71e4-168">Existem outras soluções no local também disponíveis.</span><span class="sxs-lookup"><span data-stu-id="c71e4-168">There are other on-premises solutions available as well.</span></span>

<span data-ttu-id="c71e4-169">**O Controlador Kubernetes Ingress** expõe as rotas HTTP(S) a serviços num cluster kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-169">**Kubernetes Ingress Controller** exposes HTTP(S) routes to services in a Kubernetes cluster.</span></span> <span data-ttu-id="c71e4-170">Para este fim, pode utilizar-se o Nginx ou qualquer controlador de entrada adequado.</span><span class="sxs-lookup"><span data-stu-id="c71e4-170">Nginx or any suitable ingress controller can be used for this purpose.</span></span>

<span data-ttu-id="c71e4-171">**Helm** é um gestor de pacotes para a implementação de Kubernetes, fornecendo uma maneira de agregar diferentes objetos Kubernetes como Implementações, Serviços, Segredos, em um único "gráfico".</span><span class="sxs-lookup"><span data-stu-id="c71e4-171">**Helm** is a package manager for Kubernetes deployment, providing a way to bundle different Kubernetes objects like Deployments, Services, Secrets, into a single "chart".</span></span> <span data-ttu-id="c71e4-172">Pode publicar, implementar, controlar a gestão da versão e atualizar um objeto de gráfico.</span><span class="sxs-lookup"><span data-stu-id="c71e4-172">You can publish, deploy, control version management, and update a chart  object.</span></span> <span data-ttu-id="c71e4-173">O registo do contentor Azure pode ser usado como repositório para armazenar gráficos de leme embalados.</span><span class="sxs-lookup"><span data-stu-id="c71e4-173">Azure Container Registry can be used as a repository to store packaged Helm Charts.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="c71e4-174">Considerações de conceção</span><span class="sxs-lookup"><span data-stu-id="c71e4-174">Design considerations</span></span>

<span data-ttu-id="c71e4-175">Este padrão segue algumas considerações de alto nível explicadas mais detalhadamente nas secções seguintes deste artigo:</span><span class="sxs-lookup"><span data-stu-id="c71e4-175">This pattern follows a few high-level considerations explained in more detail in the next sections of this article:</span></span>

- <span data-ttu-id="c71e4-176">A aplicação utiliza soluções nativas de Kubernetes, para evitar o bloqueio do fornecedor.</span><span class="sxs-lookup"><span data-stu-id="c71e4-176">The application uses Kubernetes-native solutions, to avoid vendor lock-in.</span></span>
- <span data-ttu-id="c71e4-177">A aplicação utiliza uma arquitetura de microserviços.</span><span class="sxs-lookup"><span data-stu-id="c71e4-177">The application uses a microservices architecture.</span></span>
- <span data-ttu-id="c71e4-178">O Azure Stack Hub não precisa de entrada, mas permite a conectividade de saída da Internet.</span><span class="sxs-lookup"><span data-stu-id="c71e4-178">Azure Stack Hub doesn't need inbound but allows outbound Internet connectivity.</span></span>

<span data-ttu-id="c71e4-179">Estas práticas recomendadas aplicar-se-ão também às cargas de trabalho e cenários do mundo real.</span><span class="sxs-lookup"><span data-stu-id="c71e4-179">These recommended practices will apply to real-world workloads and scenarios as well.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="c71e4-180">Considerações de escalabilidade</span><span class="sxs-lookup"><span data-stu-id="c71e4-180">Scalability considerations</span></span>

<span data-ttu-id="c71e4-181">A escalabilidade é importante para fornecer aos utilizadores um acesso consistente, fiável e bem-realizado à aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-181">Scalability is important to provide users consistent, reliable, and well-performing access to the application.</span></span>

<span data-ttu-id="c71e4-182">O cenário da amostra cobre a escalabilidade em várias camadas da pilha de aplicações.</span><span class="sxs-lookup"><span data-stu-id="c71e4-182">The sample scenario covers scalability on multiple layers of the application stack.</span></span> <span data-ttu-id="c71e4-183">Aqui está uma visão geral de alto nível das diferentes camadas:</span><span class="sxs-lookup"><span data-stu-id="c71e4-183">Here's a high-level overview of the different layers:</span></span>

| <span data-ttu-id="c71e4-184">Nível de arquitetura</span><span class="sxs-lookup"><span data-stu-id="c71e4-184">Architecture level</span></span> | <span data-ttu-id="c71e4-185">Afeta</span><span class="sxs-lookup"><span data-stu-id="c71e4-185">Affects</span></span> | <span data-ttu-id="c71e4-186">Como posso fazê-lo?</span><span class="sxs-lookup"><span data-stu-id="c71e4-186">How?</span></span> |
| --- | --- | ---
| <span data-ttu-id="c71e4-187">Aplicação</span><span class="sxs-lookup"><span data-stu-id="c71e4-187">Application</span></span> | <span data-ttu-id="c71e4-188">Aplicação</span><span class="sxs-lookup"><span data-stu-id="c71e4-188">Application</span></span> | <span data-ttu-id="c71e4-189">Escala horizontal com base no número de cápsulas/réplicas/instâncias de contentores\*</span><span class="sxs-lookup"><span data-stu-id="c71e4-189">Horizontal scaling based on the number of Pods/Replicas/Container Instances\*</span></span> |
| <span data-ttu-id="c71e4-190">Cluster</span><span class="sxs-lookup"><span data-stu-id="c71e4-190">Cluster</span></span> | <span data-ttu-id="c71e4-191">Aglomerado de Kubernetes</span><span class="sxs-lookup"><span data-stu-id="c71e4-191">Kubernetes cluster</span></span> | <span data-ttu-id="c71e4-192">Número de nós (entre 1 e 50), tamanhos VM-SKU e Piscinas de Nó (Motor AKS no Azure Stack Hub suporta atualmente apenas uma piscina de nó); utilizando o comando de escala do motor AKS (manual)</span><span class="sxs-lookup"><span data-stu-id="c71e4-192">Number of Nodes (between 1 and 50), VM-SKU-sizes, and Node Pools (AKS Engine on Azure Stack Hub currently supports only a single node pool); using AKS Engine's scale command (manual)</span></span> |
| <span data-ttu-id="c71e4-193">Infraestrutura</span><span class="sxs-lookup"><span data-stu-id="c71e4-193">Infrastructure</span></span> | <span data-ttu-id="c71e4-194">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="c71e4-194">Azure Stack Hub</span></span> | <span data-ttu-id="c71e4-195">Número de nós, capacidade e unidades de escala dentro de uma implantação do Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="c71e4-195">Number of nodes, capacity, and scale units within an Azure Stack Hub deployment</span></span> |

<span data-ttu-id="c71e4-196">\* Utilizando o autoescala de pod horizontal de Kubernetes (HPA); escala métrica automatizada ou escala vertical dimensionando as instâncias do recipiente (cpu/memória).</span><span class="sxs-lookup"><span data-stu-id="c71e4-196">\* Using Kubernetes' Horizontal Pod Autoscaler (HPA); automated metric-based scaling or vertical scaling by sizing the container instances (cpu/memory).</span></span>

<span data-ttu-id="c71e4-197">**Azure Stack Hub (nível de infraestrutura)**</span><span class="sxs-lookup"><span data-stu-id="c71e4-197">**Azure Stack Hub (infrastructure level)**</span></span>

<span data-ttu-id="c71e4-198">A infraestrutura Azure Stack Hub é a base desta implementação, porque o Azure Stack Hub funciona com hardware físico num datacenter.</span><span class="sxs-lookup"><span data-stu-id="c71e4-198">The Azure Stack Hub infrastructure is the foundation of this implementation, because Azure Stack Hub runs on physical hardware in a datacenter.</span></span> <span data-ttu-id="c71e4-199">Ao selecionar o hardware do Hub, tem de fazer escolhas para CPU, densidade de memória, configuração de armazenamento e número de servidores.</span><span class="sxs-lookup"><span data-stu-id="c71e4-199">When selecting your Hub hardware, you need to make choices for CPU, memory density, storage configuration, and number of servers.</span></span> <span data-ttu-id="c71e4-200">Para saber mais sobre a escalabilidade do Azure Stack Hub, confira os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="c71e4-200">To learn more about Azure Stack Hub's scalability, check out the following resources:</span></span>

- [<span data-ttu-id="c71e4-201">Planeamento de capacidade para a visão geral do Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="c71e4-201">Capacity planning for Azure Stack Hub overview</span></span>](/azure-stack/operator/azure-stack-capacity-planning-overview)
- [<span data-ttu-id="c71e4-202">Adicione os nóns de unidade de escala adicional no Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="c71e4-202">Add additional scale unit nodes in Azure Stack Hub</span></span>](/azure-stack/operator/azure-stack-add-scale-node)

<span data-ttu-id="c71e4-203">**Aglomerado de Kubernetes (nível de cluster)**</span><span class="sxs-lookup"><span data-stu-id="c71e4-203">**Kubernetes cluster (cluster level)**</span></span>

<span data-ttu-id="c71e4-204">O cluster Kubernetes em si é composto por, e é construído em cima de componentes IaaS Azure (Stack) incluindo computação, armazenamento e recursos de rede.</span><span class="sxs-lookup"><span data-stu-id="c71e4-204">The Kubernetes cluster itself consists of, and is built on top of Azure (Stack) IaaS components including compute, storage, and network resources.</span></span> <span data-ttu-id="c71e4-205">As soluções Kubernetes envolvem os nódoas master e worker, que são implantados como VMs em Azure (e Azure Stack Hub).</span><span class="sxs-lookup"><span data-stu-id="c71e4-205">Kubernetes solutions involve master and worker nodes, which are deployed as VMs in Azure (and Azure Stack Hub).</span></span>

- <span data-ttu-id="c71e4-206">[Os nós de avião de controlo](/azure/aks/concepts-clusters-workloads#control-plane) (master) fornecem os serviços de Base Kubernetes e a orquestração das cargas de trabalho de aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-206">[Control plane nodes](/azure/aks/concepts-clusters-workloads#control-plane) (master) provide the core Kubernetes services and orchestration of application workloads.</span></span>
- <span data-ttu-id="c71e4-207">[Os nós dos trabalhadores](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (trabalhador) executam as suas cargas de trabalho de aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-207">[Worker nodes](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (worker) run your application workloads.</span></span>

<span data-ttu-id="c71e4-208">Ao selecionar tamanhos de VM para a implementação inicial, existem várias considerações:</span><span class="sxs-lookup"><span data-stu-id="c71e4-208">When selecting VM sizes for the initial deployment, there are several considerations:</span></span>  

- <span data-ttu-id="c71e4-209">**Custo** - Ao planear os nós dos seus trabalhadores, tenha em mente o custo global por VM que irá incorrer.</span><span class="sxs-lookup"><span data-stu-id="c71e4-209">**Cost** - When planning your worker nodes, keep in mind the overall cost per VM you'll incur.</span></span> <span data-ttu-id="c71e4-210">Por exemplo, se as cargas de trabalho da sua aplicação requerem recursos limitados, deverá planear a implantação de VMs de menor dimensão.</span><span class="sxs-lookup"><span data-stu-id="c71e4-210">For example, if your application workloads require limited resources, you should plan to deploy smaller sized VMs.</span></span> <span data-ttu-id="c71e4-211">O Azure Stack Hub, tal como o Azure, é normalmente cobrado numa base de consumo, por isso o dimensionamento adequado dos VMs para os papéis de Kubernetes é crucial para otimizar os custos de consumo.</span><span class="sxs-lookup"><span data-stu-id="c71e4-211">Azure Stack Hub, like Azure, is normally billed on a consumption basis, so appropriately sizing the VMs for Kubernetes roles is crucial to optimizing consumption costs.</span></span> 

- <span data-ttu-id="c71e4-212">**Escalaability** - A escalabilidade do cluster é conseguida escalando e superando o número de nós mestres e trabalhadores, ou adicionando piscinas de nó adicionais (não disponível hoje no Azure Stack Hub).</span><span class="sxs-lookup"><span data-stu-id="c71e4-212">**Scalability** - Scalability of the cluster is achieved by scaling in and out the number of master and worker nodes, or by adding additional node pools (not available on Azure Stack Hub today).</span></span> <span data-ttu-id="c71e4-213">A escala do cluster pode ser feita com base em dados de desempenho, recolhidos utilizando Insights de Contentores (Azure Monitor + Log Analytics).</span><span class="sxs-lookup"><span data-stu-id="c71e4-213">Scaling the cluster can be done based on performance data, collected using Container Insights (Azure Monitor + Log Analytics).</span></span> 

    <span data-ttu-id="c71e4-214">Se a sua aplicação precisar de mais (ou menos) recursos, pode escalar (ou entrar) os seus nós atuais horizontalmente (entre 1 e 50 nós).</span><span class="sxs-lookup"><span data-stu-id="c71e4-214">If your application needs more (or fewer) resources, you can scale out (or in) your current nodes horizontally (between 1 and 50 nodes).</span></span> <span data-ttu-id="c71e4-215">Se precisar de mais de 50 nós, pode criar um cluster adicional numa subscrição separada.</span><span class="sxs-lookup"><span data-stu-id="c71e4-215">If you need more than 50 nodes, you can create an additional cluster in a separate subscription.</span></span> <span data-ttu-id="c71e4-216">Não é possível escalar os VMs reais verticalmente para outro tamanho VM sem recolocar o cluster.</span><span class="sxs-lookup"><span data-stu-id="c71e4-216">You can't scale up the actual VMs vertically to another VM size without redeploying the cluster.</span></span>

    <span data-ttu-id="c71e4-217">O dimensionamento é feito manualmente usando o VM do ajudante do motor AKS que foi usado para implantar o cluster Kubernetes inicialmente.</span><span class="sxs-lookup"><span data-stu-id="c71e4-217">Scaling is done manually using the AKS Engine helper VM that was used to deploy the Kubernetes cluster initially.</span></span> <span data-ttu-id="c71e4-218">Para mais informações, consulte [os clusters Scaling Kubernetes](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span><span class="sxs-lookup"><span data-stu-id="c71e4-218">For more information, see [Scaling Kubernetes clusters](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span></span>

- <span data-ttu-id="c71e4-219">**Quotas** - Considere as [quotas](/azure-stack/operator/azure-stack-quota-types) que configuraste ao planear uma implantação AKS no seu Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-219">**Quotas** - Consider the [quotas](/azure-stack/operator/azure-stack-quota-types) you've configured when planning out an AKS deployment on your Azure Stack Hub.</span></span> <span data-ttu-id="c71e4-220">Certifique-se de que cada [subscrição](/azure-stack/operator/service-plan-offer-subscription-overview) tem os planos adequados e as quotas configuradas.</span><span class="sxs-lookup"><span data-stu-id="c71e4-220">Make sure each [subscription](/azure-stack/operator/service-plan-offer-subscription-overview) has the proper plans and the quotas configured.</span></span> <span data-ttu-id="c71e4-221">A subscrição terá de acomodar a quantidade de computação, armazenamento e outros serviços necessários para os seus clusters à medida que se escalonam.</span><span class="sxs-lookup"><span data-stu-id="c71e4-221">The subscription will need to accommodate the amount of compute, storage, and other services needed for your clusters as they scale out.</span></span>

- <span data-ttu-id="c71e4-222">**Cargas de trabalho de aplicação** - Consulte os [conceitos de Clusters e cargas de trabalho](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) nos conceitos fundamentais de Kubernetes para o documento de serviço Azure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-222">**Application workloads** - Refer to the [Clusters and workloads concepts](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) in the Kubernetes core concepts for Azure Kubernetes Service document.</span></span> <span data-ttu-id="c71e4-223">Este artigo irá ajudá-lo a estender o tamanho vm adequado com base nas necessidades de cálculo e memória da sua aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-223">This article will help you scope the proper VM size based on the compute and memory needs of your application.</span></span>  

<span data-ttu-id="c71e4-224">**Aplicação (nível de aplicação)**</span><span class="sxs-lookup"><span data-stu-id="c71e4-224">**Application (application level)**</span></span>

<span data-ttu-id="c71e4-225">Na camada de aplicação, utilizamos Kubernetes [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span><span class="sxs-lookup"><span data-stu-id="c71e4-225">On the application layer, we use Kubernetes [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span></span> <span data-ttu-id="c71e4-226">O HPA pode aumentar ou diminuir o número de réplicas (Pod/Container Instances) na nossa implantação com base em diferentes métricas (como a utilização do CPU).</span><span class="sxs-lookup"><span data-stu-id="c71e4-226">HPA can increase or decrease the number of Replicas (Pod/Container Instances) in our deployment based on different metrics (like CPU utilization).</span></span>

<span data-ttu-id="c71e4-227">Outra opção é escalar os casos de contentores verticalmente.</span><span class="sxs-lookup"><span data-stu-id="c71e4-227">Another option is to scale container instances vertically.</span></span> <span data-ttu-id="c71e4-228">Isto pode ser conseguido alterando a quantidade de CPU e Memória solicitadas e disponíveis para uma implementação específica.</span><span class="sxs-lookup"><span data-stu-id="c71e4-228">This can be accomplished by changing the amount of CPU and Memory requested and available for a specific deployment.</span></span> <span data-ttu-id="c71e4-229">Consulte [a Gestão de Recursos para Contentores](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) em kubernetes.io para saber mais.</span><span class="sxs-lookup"><span data-stu-id="c71e4-229">See [Managing Resources for Containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) on kubernetes.io to learn more.</span></span>

## <a name="networking-and-connectivity-considerations"></a><span data-ttu-id="c71e4-230">Considerações de networking e conectividade</span><span class="sxs-lookup"><span data-stu-id="c71e4-230">Networking and connectivity considerations</span></span>

<span data-ttu-id="c71e4-231">O networking e a conectividade também afetam as três camadas mencionadas anteriormente para Kubernetes no Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-231">Networking and connectivity also affect the three layers mentioned previously for Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="c71e4-232">A tabela a seguir mostra as camadas e quais os serviços que contêm:</span><span class="sxs-lookup"><span data-stu-id="c71e4-232">The following table shows the layers and which services they contain:</span></span>

| <span data-ttu-id="c71e4-233">Camada</span><span class="sxs-lookup"><span data-stu-id="c71e4-233">Layer</span></span> | <span data-ttu-id="c71e4-234">Afeta</span><span class="sxs-lookup"><span data-stu-id="c71e4-234">Affects</span></span> | <span data-ttu-id="c71e4-235">What?</span><span class="sxs-lookup"><span data-stu-id="c71e4-235">What?</span></span> |
| --- | --- | ---
| <span data-ttu-id="c71e4-236">Aplicação</span><span class="sxs-lookup"><span data-stu-id="c71e4-236">Application</span></span> | <span data-ttu-id="c71e4-237">Aplicação</span><span class="sxs-lookup"><span data-stu-id="c71e4-237">Application</span></span> | <span data-ttu-id="c71e4-238">Como é que a aplicação está acessível?</span><span class="sxs-lookup"><span data-stu-id="c71e4-238">How is the application accessible?</span></span> <span data-ttu-id="c71e4-239">Será exposto à Internet?</span><span class="sxs-lookup"><span data-stu-id="c71e4-239">Will it be exposed to the Internet?</span></span> |
| <span data-ttu-id="c71e4-240">Cluster</span><span class="sxs-lookup"><span data-stu-id="c71e4-240">Cluster</span></span> | <span data-ttu-id="c71e4-241">Aglomerado de Kubernetes</span><span class="sxs-lookup"><span data-stu-id="c71e4-241">Kubernetes cluster</span></span> | <span data-ttu-id="c71e4-242">Kubernetes API, AKS Engine VM, Pull container images (egress), Envio de dados de monitorização e telemetria (saída)</span><span class="sxs-lookup"><span data-stu-id="c71e4-242">Kubernetes API, AKS Engine VM, Pulling container images (egress), Sending monitoring data and telemetry (egress)</span></span> |
| <span data-ttu-id="c71e4-243">Infraestrutura</span><span class="sxs-lookup"><span data-stu-id="c71e4-243">Infrastructure</span></span> | <span data-ttu-id="c71e4-244">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="c71e4-244">Azure Stack Hub</span></span> | <span data-ttu-id="c71e4-245">Acessibilidade dos pontos finais de gestão do Azure Stack Hub, como o portal e os pontos finais do Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="c71e4-245">Accessibility of the Azure Stack Hub management endpoints like the portal and Azure Resource Manager endpoints.</span></span> |

<span data-ttu-id="c71e4-246">**Aplicação**</span><span class="sxs-lookup"><span data-stu-id="c71e4-246">**Application**</span></span>

<span data-ttu-id="c71e4-247">Para a camada de aplicação, a consideração mais importante é se a aplicação está exposta e acessível a partir da Internet.</span><span class="sxs-lookup"><span data-stu-id="c71e4-247">For the application layer, the most important consideration is whether the application is exposed and accessible from the Internet.</span></span> <span data-ttu-id="c71e4-248">Do ponto de vista de Kubernetes, a acessibilidade à Internet significa expor uma implementação ou pod usando um Serviço Kubernetes ou um Controlador ingress.</span><span class="sxs-lookup"><span data-stu-id="c71e4-248">From a Kubernetes perspective, Internet accessibility means exposing a deployment or pod using a Kubernetes Service or an Ingress Controller.</span></span>

> [!NOTE]
> <span data-ttu-id="c71e4-249">Recomendamos a utilização de controladores Ingress para expor os Serviços Kubernetes, uma vez que o número de IPs públicos frontend no Azure Stack Hub está limitado a 5.</span><span class="sxs-lookup"><span data-stu-id="c71e4-249">We recommend the use of Ingress controllers to expose Kubernetes Services as the number of Frontend public IPs on Azure Stack Hub is limited to 5.</span></span> <span data-ttu-id="c71e4-250">Este design também limita o número de Serviços Kubernetes (com o tipo LoadBalancer) a 5, que será muito pequeno para muitas implementações.</span><span class="sxs-lookup"><span data-stu-id="c71e4-250">This design also limits the number of Kubernetes Services (with the type LoadBalancer) to 5, which will be too small for many deployments.</span></span> <span data-ttu-id="c71e4-251">Aceda à documentação do [Motor AKS](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) para saber mais.</span><span class="sxs-lookup"><span data-stu-id="c71e4-251">Go to the [AKS Engine documentation](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) to learn more.</span></span>

<span data-ttu-id="c71e4-252">Expor uma aplicação utilizando um IP público através de um Balancer de Carga ou de um Controlador de Entradas não significa que a aplicação esteja agora acessível através da Internet.</span><span class="sxs-lookup"><span data-stu-id="c71e4-252">Exposing an application using a public IP via a Load Balancer or an Ingress Controller doesn't nessecarily mean that the application is now accessible via the Internet.</span></span> <span data-ttu-id="c71e4-253">É possível que o Azure Stack Hub tenha um endereço IP público que só seja visível na intranet local - nem todos os IPs públicos estão verdadeiramente virados para a Internet.</span><span class="sxs-lookup"><span data-stu-id="c71e4-253">It's possible for Azure Stack Hub to have a public IP address that is only visible on the local intranet - not all public IPs are truly Internet-facing.</span></span>

<span data-ttu-id="c71e4-254">O bloco anterior considera o tráfego ingresso para a aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-254">The previous block considers ingress traffic to the application.</span></span> <span data-ttu-id="c71e4-255">Outro tópico que deve ser considerado para uma implementação bem sucedida de Kubernetes é o tráfego de saída/saída.</span><span class="sxs-lookup"><span data-stu-id="c71e4-255">Another topic that must be considered for a successful Kubernetes deployment is outbound/egress traffic.</span></span> <span data-ttu-id="c71e4-256">Aqui estão alguns casos de uso que requerem tráfego de saída:</span><span class="sxs-lookup"><span data-stu-id="c71e4-256">Here are a few use cases that require egress traffic:</span></span>

- <span data-ttu-id="c71e4-257">Imagens de contentores armazenados no Registo de Contentores DockerHub ou Azure</span><span class="sxs-lookup"><span data-stu-id="c71e4-257">Pulling Container Images stored on DockerHub or Azure Container Registry</span></span>
- <span data-ttu-id="c71e4-258">Recuperação de gráficos de leme</span><span class="sxs-lookup"><span data-stu-id="c71e4-258">Retrieving Helm Charts</span></span>
- <span data-ttu-id="c71e4-259">Emissão de dados de Insights de Aplicação (ou outros dados de monitorização)</span><span class="sxs-lookup"><span data-stu-id="c71e4-259">Emitting Application Insights data (or other monitoring data)</span></span>

<span data-ttu-id="c71e4-260">Alguns ambientes empresariais podem exigir a utilização de servidores proxy _transparentes_ ou _não transparentes._</span><span class="sxs-lookup"><span data-stu-id="c71e4-260">Some enterprise environments might require the use of _transparent_ or _non-transparent_ proxy servers.</span></span> <span data-ttu-id="c71e4-261">Estes servidores requerem configuração específica em vários componentes do nosso cluster.</span><span class="sxs-lookup"><span data-stu-id="c71e4-261">These servers require specific configuration on various components of our cluster.</span></span> <span data-ttu-id="c71e4-262">A documentação do Motor AKS contém vários detalhes sobre como acomodar proxies de rede.</span><span class="sxs-lookup"><span data-stu-id="c71e4-262">The AKS Engine documentation contains various details on how to accommodate network proxies.</span></span> <span data-ttu-id="c71e4-263">Para mais detalhes, consulte [o Motor AKS e servidores proxy](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span><span class="sxs-lookup"><span data-stu-id="c71e4-263">For more details, see [AKS Engine and proxy servers](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span></span>

<span data-ttu-id="c71e4-264">Por último, o tráfego de aglomerados cruzados deve fluir entre as instâncias do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-264">Lastly, cross-cluster traffic must flow between Azure Stack Hub instances.</span></span> <span data-ttu-id="c71e4-265">A distribuição da amostra consiste em clusters individuais de Kubernetes que executam em instâncias individuais do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-265">The sample deployment consists of individual Kubernetes clusters running on individual Azure Stack Hub instances.</span></span> <span data-ttu-id="c71e4-266">O trânsito entre eles, como o tráfego de replicação entre duas bases de dados, é de "tráfego externo".</span><span class="sxs-lookup"><span data-stu-id="c71e4-266">Traffic between them, such as the replication traffic between two databases, is "external traffic".</span></span> <span data-ttu-id="c71e4-267">O tráfego externo deve ser encaminhado através de um endereço IP público do Site-to-Site ou do Azure Stack Hub para ligar Kubernetes em duas instâncias do Azure Stack Hub:</span><span class="sxs-lookup"><span data-stu-id="c71e4-267">External traffic must be routed through either a Site-to-Site VPN or Azure Stack Hub Public IP addresses to connect Kubernetes on two Azure Stack Hub instances:</span></span>

![tráfego inter e intra cluster](media/pattern-highly-available-kubernetes/aks-inter-and-intra-cluster-traffic.png)

<span data-ttu-id="c71e4-269">**Cluster**</span><span class="sxs-lookup"><span data-stu-id="c71e4-269">**Cluster**</span></span>  

<span data-ttu-id="c71e4-270">O cluster Kubernetes não precisa necessariamente de ser acessível através da Internet.</span><span class="sxs-lookup"><span data-stu-id="c71e4-270">The Kubernetes cluster doesn't necessarily need to be accessible via the Internet.</span></span> <span data-ttu-id="c71e4-271">A parte relevante é a API kubernetes usada para operar um cluster, por exemplo, utilizando `kubectl` .</span><span class="sxs-lookup"><span data-stu-id="c71e4-271">The relevant part is the Kubernetes API used to operate a cluster, for example, using `kubectl`.</span></span> <span data-ttu-id="c71e4-272">O ponto final da API kubernetes deve estar acessível a todos os que operam o cluster ou implementam aplicações e serviços em cima dele.</span><span class="sxs-lookup"><span data-stu-id="c71e4-272">The Kubernetes API endpoint must be accessible to everyone who operates the cluster or deploys applications and services on top of it.</span></span> <span data-ttu-id="c71e4-273">Este tópico é abordado mais detalhadamente a partir de uma perspetiva de DevOps na secção [de considerações de Implementação (CI/CD)](#deployment-cicd-considerations) abaixo.</span><span class="sxs-lookup"><span data-stu-id="c71e4-273">This topic is covered in more detail from a DevOps-perspective in the [Deployment (CI/CD) considerations](#deployment-cicd-considerations) section below.</span></span>

<span data-ttu-id="c71e4-274">No nível do cluster, há também algumas considerações em torno do tráfego de saídas:</span><span class="sxs-lookup"><span data-stu-id="c71e4-274">On the cluster level, there are also a few considerations around egress-traffic:</span></span>

- <span data-ttu-id="c71e4-275">Atualizações de nó (para Ubuntu)</span><span class="sxs-lookup"><span data-stu-id="c71e4-275">Node updates (for Ubuntu)</span></span>
- <span data-ttu-id="c71e4-276">Dados de monitorização (enviados à Azure LogAnalytics)</span><span class="sxs-lookup"><span data-stu-id="c71e4-276">Monitoring data (sent to Azure LogAnalytics)</span></span>
- <span data-ttu-id="c71e4-277">Outros agentes que exigem tráfego de saída (específico para o ambiente de cada desdobramento)</span><span class="sxs-lookup"><span data-stu-id="c71e4-277">Other agents requiring outbound traffic (specific to each deployer's environment)</span></span>

<span data-ttu-id="c71e4-278">Antes de implementar o seu cluster Kubernetes utilizando o Motor AKS, planeie o design final de rede.</span><span class="sxs-lookup"><span data-stu-id="c71e4-278">Before you deploy your Kubernetes cluster using AKS Engine, plan for the final networking design.</span></span> <span data-ttu-id="c71e4-279">Em vez de criar uma Rede Virtual dedicada, pode ser mais eficiente implantar um cluster numa rede existente.</span><span class="sxs-lookup"><span data-stu-id="c71e4-279">Instead of creating a dedicated Virtual Network, it may be more efficient to deploy a cluster into an existing network.</span></span> <span data-ttu-id="c71e4-280">Por exemplo, pode aproveitar uma ligação VPN local-a-local já configurada no seu ambiente Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-280">For example, you might leverage an existing Site-to-Site VPN connection already configured in your Azure Stack Hub environment.</span></span>

<span data-ttu-id="c71e4-281">**Infraestrutura**</span><span class="sxs-lookup"><span data-stu-id="c71e4-281">**Infrastructure**</span></span>  

<span data-ttu-id="c71e4-282">A infraestrutura refere-se ao acesso aos pontos finais de gestão do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-282">Infrastructure refers to accessing the Azure Stack Hub management endpoints.</span></span> <span data-ttu-id="c71e4-283">Os pontos finais incluem os portais de arrendamento e administração, e os pontos finais do Administrador de Recursos Azure e inquilinos.</span><span class="sxs-lookup"><span data-stu-id="c71e4-283">Endpoints include the tenant and admin portals, and the Azure Resource Manager admin and tenant endpoints.</span></span> <span data-ttu-id="c71e4-284">Estes pontos finais são necessários para operar o Azure Stack Hub e os seus serviços principais.</span><span class="sxs-lookup"><span data-stu-id="c71e4-284">These endpoints are required to operate Azure Stack Hub and its core services.</span></span>

## <a name="data-and-storage-considerations"></a><span data-ttu-id="c71e4-285">Considerações de dados e armazenamento</span><span class="sxs-lookup"><span data-stu-id="c71e4-285">Data and storage considerations</span></span>

<span data-ttu-id="c71e4-286">Duas instâncias da nossa aplicação serão implementadas em dois clusters individuais de Kubernetes, através de duas instâncias do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-286">Two instances of our application will be deployed, on two individual Kubernetes clusters, across two Azure Stack Hub instances.</span></span> <span data-ttu-id="c71e4-287">Este design vai exigir que consideremos como replicar e sincronizar dados entre eles.</span><span class="sxs-lookup"><span data-stu-id="c71e4-287">This design will require us to consider how to replicate and synchronize data between them.</span></span>

<span data-ttu-id="c71e4-288">Com o Azure, temos a capacidade incorporada de replicar o armazenamento em várias regiões e zonas dentro da nuvem.</span><span class="sxs-lookup"><span data-stu-id="c71e4-288">With Azure, we have the built-in capability to replicate storage across multiple regions and zones within the cloud.</span></span> <span data-ttu-id="c71e4-289">Atualmente com o Azure Stack Hub não existem formas nativas de replicar o armazenamento em duas instâncias diferentes do Azure Stack Hub - formam duas nuvens independentes sem forma abrangente de as gerir como um conjunto.</span><span class="sxs-lookup"><span data-stu-id="c71e4-289">Currently with Azure Stack Hub there are no native ways to replicate storage across two different Azure Stack Hub instances - they form two independent clouds with no overarching way to manage them as a set.</span></span> <span data-ttu-id="c71e4-290">O planeamento da resiliência das aplicações que atravessam o Azure Stack Hub obriga-o a considerar esta independência no design e implementações da sua aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-290">Planning for resiliency of applications running across Azure Stack Hub forces you to consider this independence in your application design and deployments.</span></span>

<span data-ttu-id="c71e4-291">Na maioria dos casos, a replicação de armazenamento não será necessária para uma aplicação resiliente e altamente disponível implantada em AKS.</span><span class="sxs-lookup"><span data-stu-id="c71e4-291">In most cases, storage replication won't be necessary for a resilient and highly available application deployed on AKS.</span></span> <span data-ttu-id="c71e4-292">Mas deve considerar o armazenamento independente por exemplo do Azure Stack Hub no design da sua aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-292">But you should consider independent storage per Azure Stack Hub instance in your application design.</span></span> <span data-ttu-id="c71e4-293">Se este design for uma preocupação ou um bloqueio de estrada para implementar a solução no Azure Stack Hub, existem possíveis soluções da Microsoft Partners que fornecem anexos de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="c71e4-293">If this design is a concern or road block to deploying the solution on Azure Stack Hub, there are possible solutions from Microsoft Partners that provide storage attachments.</span></span> <span data-ttu-id="c71e4-294">Os anexos de armazenamento fornecem uma solução de replicação de armazenamento através de múltiplos Hubs Azure Stack e Azure.</span><span class="sxs-lookup"><span data-stu-id="c71e4-294">Storage attachments provide a storage replication solution across multiple Azure Stack Hubs and Azure.</span></span> <span data-ttu-id="c71e4-295">Para mais informações, consulte as [soluções Partner.](#partner-solutions)</span><span class="sxs-lookup"><span data-stu-id="c71e4-295">For more information, see the [Partner solutions](#partner-solutions).</span></span>

<span data-ttu-id="c71e4-296">Na nossa arquitetura, estas camadas foram consideradas:</span><span class="sxs-lookup"><span data-stu-id="c71e4-296">In our architecture, these layers were considered:</span></span>

<span data-ttu-id="c71e4-297">**Configuração**</span><span class="sxs-lookup"><span data-stu-id="c71e4-297">**Configuration**</span></span>

<span data-ttu-id="c71e4-298">A configuração inclui a configuração do Azure Stack Hub, do Motor AKS e do próprio cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-298">Configuration includes the configuration of Azure Stack Hub, AKS Engine, and the Kubernetes cluster itself.</span></span> <span data-ttu-id="c71e4-299">A configuração deve ser automatizada tanto quanto possível, e armazenada como Infra-estrutura-como-Código num sistema de controlo de versão baseado em Git, como Azure DevOps ou GitHub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-299">The configuration should be automated as much as possible, and stored as Infrastructure-as-Code in a Git-based version control system like Azure DevOps or GitHub.</span></span> <span data-ttu-id="c71e4-300">Estas definições não podem ser facilmente sincronizadas em várias implementações.</span><span class="sxs-lookup"><span data-stu-id="c71e4-300">These settings cannot easily be synchronized across multiple deployments.</span></span> <span data-ttu-id="c71e4-301">Por isso, recomendamos armazenar e aplicar a configuração a partir do exterior e utilizar o gasoduto DevOps.</span><span class="sxs-lookup"><span data-stu-id="c71e4-301">Therefore we recommend storing and applying configuration from the outside, and using DevOps pipeline.</span></span>

<span data-ttu-id="c71e4-302">**Aplicação**</span><span class="sxs-lookup"><span data-stu-id="c71e4-302">**Application**</span></span>

<span data-ttu-id="c71e4-303">A aplicação deve ser armazenada num repositório baseado em Git.</span><span class="sxs-lookup"><span data-stu-id="c71e4-303">The application should be stored in a Git-based repository.</span></span> <span data-ttu-id="c71e4-304">Sempre que há uma nova implementação, alterações na aplicação, ou recuperação de desastres, pode ser facilmente implantada usando Azure Pipelines.</span><span class="sxs-lookup"><span data-stu-id="c71e4-304">Whenever there's a new deployment, changes to the application, or disaster recovery, it can be easily deployed using Azure Pipelines.</span></span>

<span data-ttu-id="c71e4-305">**Dados**</span><span class="sxs-lookup"><span data-stu-id="c71e4-305">**Data**</span></span>

<span data-ttu-id="c71e4-306">Os dados são a consideração mais importante na maioria dos desenhos de aplicações.</span><span class="sxs-lookup"><span data-stu-id="c71e4-306">Data is the most important consideration in most application designs.</span></span> <span data-ttu-id="c71e4-307">Os dados da aplicação devem permanecer sincronizados entre as diferentes instâncias da aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-307">Application data must stay in sync between the different instances of the application.</span></span> <span data-ttu-id="c71e4-308">Os dados também precisam de uma estratégia de backup e recuperação de desastres se houver uma paragem.</span><span class="sxs-lookup"><span data-stu-id="c71e4-308">Data also needs a backup and disaster recovery strategy if there's an outage.</span></span>

<span data-ttu-id="c71e4-309">Alcançar este design depende muito das escolhas tecnológicas.</span><span class="sxs-lookup"><span data-stu-id="c71e4-309">Achieving this design depends heavily on technology choices.</span></span> <span data-ttu-id="c71e4-310">Aqui estão alguns exemplos de solução para implementar uma base de dados de uma forma altamente disponível no Azure Stack Hub:</span><span class="sxs-lookup"><span data-stu-id="c71e4-310">Here are some solution examples for implementing a database in a highly available fashion on Azure Stack Hub:</span></span>

- [<span data-ttu-id="c71e4-311">Implementar um grupo de disponibilidade SQL Server 2016 para Azure e Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="c71e4-311">Deploy a SQL Server 2016 availability group to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-sql-ha)
- [<span data-ttu-id="c71e4-312">Implemente uma solução MongoDB altamente disponível para O Azure e Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="c71e4-312">Deploy a highly available MongoDB solution to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-mongodb-ha)

<span data-ttu-id="c71e4-313">Considerações ao trabalhar com dados em vários locais é uma consideração ainda mais complexa para uma solução altamente disponível e resiliente.</span><span class="sxs-lookup"><span data-stu-id="c71e4-313">Considerations when working with data across multiple locations is an even more complex consideration for a highly available and resilient solution.</span></span> <span data-ttu-id="c71e4-314">Considere:</span><span class="sxs-lookup"><span data-stu-id="c71e4-314">Consider:</span></span>

- <span data-ttu-id="c71e4-315">Latência e conectividade de rede entre Azure Stack Hubs.</span><span class="sxs-lookup"><span data-stu-id="c71e4-315">Latency and network connectivity between Azure Stack Hubs.</span></span>
- <span data-ttu-id="c71e4-316">Disponibilidade de identidades para serviços e permissões.</span><span class="sxs-lookup"><span data-stu-id="c71e4-316">Availability of identities for services and permissions.</span></span> <span data-ttu-id="c71e4-317">Cada exemplo do Azure Stack Hub integra-se com um diretório externo.</span><span class="sxs-lookup"><span data-stu-id="c71e4-317">Each Azure Stack Hub instance integrates with an external directory.</span></span> <span data-ttu-id="c71e4-318">Durante a implementação, opta por utilizar o Azure Ative Directory (Azure AD) ou o Ative Directory Federation Services (ADFS).</span><span class="sxs-lookup"><span data-stu-id="c71e4-318">During deployment, you choose to use either Azure Active Directory (Azure AD) or Active Directory Federation Services (ADFS).</span></span> <span data-ttu-id="c71e4-319">Como tal, existe o potencial de usar uma única identidade que pode interagir com vários casos independentes do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-319">As such, there's potential to use a single identity that can interact with multiple independent Azure Stack Hub instances.</span></span>

## <a name="business-continuity-and-disaster-recovery"></a><span data-ttu-id="c71e4-320">Continuidade de negócio e recuperação após desastre</span><span class="sxs-lookup"><span data-stu-id="c71e4-320">Business continuity and disaster recovery</span></span>

<span data-ttu-id="c71e4-321">A continuidade do negócio e a recuperação de desastres (BCDR) é um tema importante tanto no Azure Stack Hub como no Azure.</span><span class="sxs-lookup"><span data-stu-id="c71e4-321">Business continuity and disaster recovery (BCDR) is an important topic in both Azure Stack Hub and Azure.</span></span> <span data-ttu-id="c71e4-322">A principal diferença é que no Azure Stack Hub, o operador deve gerir todo o processo BCDR.</span><span class="sxs-lookup"><span data-stu-id="c71e4-322">The main difference is that in Azure Stack Hub, the operator must manage the whole BCDR process.</span></span> <span data-ttu-id="c71e4-323">Em Azure, partes do BCDR são geridas automaticamente pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c71e4-323">In Azure, parts of BCDR are automatically managed by Microsoft.</span></span>

<span data-ttu-id="c71e4-324">O BCDR afeta as mesmas áreas mencionadas na secção anterior [Dados e considerações de armazenamento:](#data-and-storage-considerations)</span><span class="sxs-lookup"><span data-stu-id="c71e4-324">BCDR affects the same areas mentioned in the previous section [Data and storage considerations](#data-and-storage-considerations):</span></span>

- <span data-ttu-id="c71e4-325">Infraestrutura / Configuração</span><span class="sxs-lookup"><span data-stu-id="c71e4-325">Infrastructure / Configuration</span></span>
- <span data-ttu-id="c71e4-326">Disponibilidade de candidaturas</span><span class="sxs-lookup"><span data-stu-id="c71e4-326">Application Availability</span></span>
- <span data-ttu-id="c71e4-327">Dados da Aplicação</span><span class="sxs-lookup"><span data-stu-id="c71e4-327">Application Data</span></span>

<span data-ttu-id="c71e4-328">E como mencionado na secção anterior, estas áreas são da responsabilidade do operador Azure Stack Hub e podem variar entre organizações.</span><span class="sxs-lookup"><span data-stu-id="c71e4-328">And as mentioned in the previous section, these areas are the responsibility of the Azure Stack Hub operator and can vary between organizations.</span></span> <span data-ttu-id="c71e4-329">Planeie o BCDR de acordo com as suas ferramentas e processos disponíveis.</span><span class="sxs-lookup"><span data-stu-id="c71e4-329">Plan BCDR according to your available tools and processes.</span></span>

<span data-ttu-id="c71e4-330">**Infraestrutura e configuração**</span><span class="sxs-lookup"><span data-stu-id="c71e4-330">**Infrastructure and configuration**</span></span>

<span data-ttu-id="c71e4-331">Esta secção abrange a infraestrutura física e lógica e a configuração do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-331">This section covers the physical and logical infrastructure and the configuration of Azure Stack Hub.</span></span> <span data-ttu-id="c71e4-332">Abrange ações na administração e nos espaços de arrendamento.</span><span class="sxs-lookup"><span data-stu-id="c71e4-332">It covers actions in the admin and the tenant spaces.</span></span>

<span data-ttu-id="c71e4-333">O operador do Azure Stack Hub (ou administrador) é responsável pela manutenção das instâncias Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-333">The Azure Stack Hub operator (or administrator) is responsible for maintenance of the Azure Stack Hub instances.</span></span> <span data-ttu-id="c71e4-334">Incluindo componentes como a rede, armazenamento, identidade e outros tópicos que estão fora do âmbito deste artigo.</span><span class="sxs-lookup"><span data-stu-id="c71e4-334">Including components such as the network, storage, identity, and other topics that are outside the scope of this article.</span></span> <span data-ttu-id="c71e4-335">Para saber mais sobre as especificidades das operações do Azure Stack Hub, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="c71e4-335">To learn more about the specifics of Azure Stack Hub operations, see the following resources:</span></span>

- [<span data-ttu-id="c71e4-336">Recuperar dados no Azure Stack Hub com o Serviço de Backup de Infraestruturas</span><span class="sxs-lookup"><span data-stu-id="c71e4-336">Recover data in Azure Stack Hub with the Infrastructure Backup Service</span></span>](/azure-stack/operator/azure-stack-backup-infrastructure-backup)
- [<span data-ttu-id="c71e4-337">Ativar a cópia de segurança para O Azure Stack Hub a partir do portal do administrador</span><span class="sxs-lookup"><span data-stu-id="c71e4-337">Enable backup for Azure Stack Hub from the administrator portal</span></span>](/azure-stack/operator/azure-stack-backup-enable-backup-console)
- <span data-ttu-id="c71e4-338">[Recover from catastrophic data loss](/azure-stack/operator/azure-stack-backup-recover-data) (Recuperar de uma perda de dados catastrófica)</span><span class="sxs-lookup"><span data-stu-id="c71e4-338">[Recover from catastrophic data loss](/azure-stack/operator/azure-stack-backup-recover-data)</span></span>
- <span data-ttu-id="c71e4-339">[Infrastructure Backup Service best practices](/azure-stack/operator/azure-stack-backup-best-practices) (Melhores práticas do Infrastructure Backup Service)</span><span class="sxs-lookup"><span data-stu-id="c71e4-339">[Infrastructure Backup Service best practices](/azure-stack/operator/azure-stack-backup-best-practices)</span></span>

<span data-ttu-id="c71e4-340">Azure Stack Hub é a plataforma e tecido em que serão implementadas aplicações Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-340">Azure Stack Hub is the platform and fabric on which Kubernetes applications will be deployed.</span></span> <span data-ttu-id="c71e4-341">O proprietário da aplicação Kubernetes será um utilizador do Azure Stack Hub, com acesso concedido para implementar a infraestrutura de aplicação necessária para a solução.</span><span class="sxs-lookup"><span data-stu-id="c71e4-341">The application owner for the Kubernetes application will be a user of Azure Stack Hub, with access granted to deploy the application infrastructure needed for the solution.</span></span> <span data-ttu-id="c71e4-342">Neste caso, a infraestrutura de aplicações significa o cluster Kubernetes, implantado com motor AKS e os serviços circundantes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-342">Application infrastructure in this case means the Kubernetes cluster, deployed using AKS Engine, and the surrounding services.</span></span> <span data-ttu-id="c71e4-343">Estes componentes serão implantados no Azure Stack Hub, limitados por uma oferta do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-343">These components will be deployed into Azure Stack Hub, constrained by an Azure Stack Hub offer.</span></span> <span data-ttu-id="c71e4-344">Certifique-se de que a oferta aceite pelo proprietário da aplicação Kubernetes tem capacidade suficiente (expressa nas quotas Azure Stack Hub) para implementar toda a solução.</span><span class="sxs-lookup"><span data-stu-id="c71e4-344">Make sure the offer accepted by the Kubernetes application owner has sufficient capacity (expressed in Azure Stack Hub quotas) to deploy the entire solution.</span></span> <span data-ttu-id="c71e4-345">Como recomendado na secção anterior, a implementação da aplicação deve ser automatizada utilizando infraestruturas como código e oleodutos de implantação como os gasodutos Azure DevOps Azure.</span><span class="sxs-lookup"><span data-stu-id="c71e4-345">As recommended in the previous section, the application deployment should be automated using Infrastructure-as-Code and deployment pipelines like Azure DevOps Azure Pipelines.</span></span>

<span data-ttu-id="c71e4-346">Para obter mais informações sobre ofertas e quotas do Azure Stack Hub, consulte [os serviços, planos, ofertas e subscrições do Azure Stack Hub](/azure-stack/operator/service-plan-offer-subscription-overview)</span><span class="sxs-lookup"><span data-stu-id="c71e4-346">For more information on Azure Stack Hub offers and quotas, see [Azure Stack Hub services, plans, offers, and subscriptions overview](/azure-stack/operator/service-plan-offer-subscription-overview)</span></span>

<span data-ttu-id="c71e4-347">É importante guardar e armazenar de forma segura a configuração do Motor AKS, incluindo as suas saídas.</span><span class="sxs-lookup"><span data-stu-id="c71e4-347">It's important to securely save and store the AKS Engine configuration including its outputs.</span></span> <span data-ttu-id="c71e4-348">Estes ficheiros contêm informações confidenciais utilizadas para aceder ao cluster Kubernetes, pelo que devem ser protegidos contra a exposição a não administradores.</span><span class="sxs-lookup"><span data-stu-id="c71e4-348">These files contain confidential information used to access the Kubernetes cluster, so it must be protected from being exposed to non-administrators.</span></span>

<span data-ttu-id="c71e4-349">**Disponibilidade de candidaturas**</span><span class="sxs-lookup"><span data-stu-id="c71e4-349">**Application availability**</span></span>

<span data-ttu-id="c71e4-350">A aplicação não deve basear-se em cópias de segurança de uma instância implantada.</span><span class="sxs-lookup"><span data-stu-id="c71e4-350">The application shouldn't rely on backups of a deployed instance.</span></span> <span data-ttu-id="c71e4-351">Como prática padrão, reimplante a aplicação completamente seguindo os padrões infra-como-código.</span><span class="sxs-lookup"><span data-stu-id="c71e4-351">As a standard practice, redeploy the application completely following Infrastructure-as-Code patterns.</span></span> <span data-ttu-id="c71e4-352">Por exemplo, reenfectuar utilizando gasodutos Azure DevOps Azure.</span><span class="sxs-lookup"><span data-stu-id="c71e4-352">For example, redeploy using Azure DevOps Azure Pipelines.</span></span> <span data-ttu-id="c71e4-353">O procedimento BCDR deve envolver a reafectação do pedido para o mesmo ou outro cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-353">The BCDR procedure should involve the redeployment of the application to the same or another Kubernetes cluster.</span></span>

<span data-ttu-id="c71e4-354">**Dados da aplicação**</span><span class="sxs-lookup"><span data-stu-id="c71e4-354">**Application data**</span></span>

<span data-ttu-id="c71e4-355">Os dados da aplicação são a parte crítica para minimizar a perda de dados.</span><span class="sxs-lookup"><span data-stu-id="c71e4-355">Application data is the critical part to minimize data loss.</span></span> <span data-ttu-id="c71e4-356">Na secção anterior, foram descritas técnicas para replicar e sincronizar dados entre duas (ou mais) instâncias da aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-356">In the previous section, techniques to replicate and synchronize data between two (or more) instances of the application were described.</span></span> <span data-ttu-id="c71e4-357">Dependendo da infraestrutura de base de dados (MySQL, MongoDB, MSSQL ou outros) utilizada para armazenar os dados, haverá diferentes técnicas de disponibilidade de base de dados e técnicas de backup disponíveis para escolher.</span><span class="sxs-lookup"><span data-stu-id="c71e4-357">Depending on the database infrastructure (MySQL, MongoDB, MSSQL or others) used to store the data, there will be different database availability and backup techniques available to choose from.</span></span>

<span data-ttu-id="c71e4-358">As formas recomendadas de alcançar a integridade são usar:</span><span class="sxs-lookup"><span data-stu-id="c71e4-358">The recommended ways to achieve integrity are to use either:</span></span>
- <span data-ttu-id="c71e4-359">Uma solução de reserva nativa para a base de dados específica.</span><span class="sxs-lookup"><span data-stu-id="c71e4-359">A native backup solution for the specific database.</span></span>
- <span data-ttu-id="c71e4-360">Uma solução de backup que suporta oficialmente o backup e a recuperação do tipo de base de dados utilizado pela sua aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-360">A backup solution that officially supports backup and recovery of the database type used by your application.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c71e4-361">Não guarde os seus dados de backup na mesma instância do Azure Stack Hub onde os dados da sua aplicação residem.</span><span class="sxs-lookup"><span data-stu-id="c71e4-361">Do not store your backup data on the same Azure Stack Hub instance where your application data resides.</span></span> <span data-ttu-id="c71e4-362">Uma paragem completa da instância Azure Stack Hub também comprometeria as suas cópias de segurança.</span><span class="sxs-lookup"><span data-stu-id="c71e4-362">A complete outage of the Azure Stack Hub instance would also compromise your backups.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="c71e4-363">Considerações de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="c71e4-363">Availability considerations</span></span>

<span data-ttu-id="c71e4-364">Kubernetes no Azure Stack Hub implantado através do Motor AKS não é um serviço gerido.</span><span class="sxs-lookup"><span data-stu-id="c71e4-364">Kubernetes on Azure Stack Hub deployed via AKS Engine isn't a managed service.</span></span> <span data-ttu-id="c71e4-365">É uma implementação automatizada e configuração de um cluster Kubernetes usando Azure Infrastructure-as-a-Service (IaaS).</span><span class="sxs-lookup"><span data-stu-id="c71e4-365">It's an automated deployment and configuration of a Kubernetes cluster using Azure Infrastructure-as-a-Service (IaaS).</span></span> <span data-ttu-id="c71e4-366">Como tal, proporciona a mesma disponibilidade que a infraestrutura subjacente.</span><span class="sxs-lookup"><span data-stu-id="c71e4-366">As such, it provides the same availability as the underlying infrastructure.</span></span>

<span data-ttu-id="c71e4-367">A infraestrutura Azure Stack Hub já é resistente a falhas, e fornece capacidades como Conjuntos de Disponibilidade para distribuir componentes em vários [domínios de falha e atualização](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span><span class="sxs-lookup"><span data-stu-id="c71e4-367">Azure Stack Hub infrastructure is already resilient to failures, and provides capabilities like Availability Sets to distribute components across multiple [fault and update domains](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span></span> <span data-ttu-id="c71e4-368">Mas a tecnologia subjacente (clustering failover) ainda incorre em algum tempo de inatividade para VMs em um servidor físico impactado, se houver uma falha de hardware.</span><span class="sxs-lookup"><span data-stu-id="c71e4-368">But the underlying technology (failover clustering) still incurs some downtime for VMs on an impacted physical server, if there's a hardware failure.</span></span>

<span data-ttu-id="c71e4-369">É uma boa prática implementar o seu cluster Kubernetes de produção, bem como a carga de trabalho para dois (ou mais) clusters.</span><span class="sxs-lookup"><span data-stu-id="c71e4-369">It's a good practice to deploy your production Kubernetes cluster as well as the workload to two (or more) clusters.</span></span> <span data-ttu-id="c71e4-370">Estes clusters devem ser hospedados em diferentes locais ou datacenters, e usar tecnologias como o Azure Traffic Manager para encaminhar os utilizadores com base no tempo de resposta do cluster ou com base na geografia.</span><span class="sxs-lookup"><span data-stu-id="c71e4-370">These clusters should be hosted in different locations or datacenters, and use technologies like Azure Traffic Manager to route users based on cluster response time or based on geography.</span></span>

![Utilizar o Gestor de Tráfego para controlar os fluxos de tráfego](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager.png)

<span data-ttu-id="c71e4-372">Os clientes que têm um único cluster Kubernetes normalmente conectam-se ao nome IP ou DNS de serviço de uma determinada aplicação.</span><span class="sxs-lookup"><span data-stu-id="c71e4-372">Customers who have a single Kubernetes cluster typically connect to the service IP or DNS name of a given application.</span></span> <span data-ttu-id="c71e4-373">Numa implementação multi-cluster, os clientes devem ligar-se a um nome DNS do Gestor de Tráfego que aponta para os serviços/entradas em cada cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-373">In a multi-cluster deployment, customers should connect to a Traffic Manager DNS name that points to the services/ingress on each Kubernetes cluster.</span></span>

![Utilizar o Gestor de Tráfego para encaminhar para o cluster no local](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager-on-premises.png)

> [!NOTE]
> <span data-ttu-id="c71e4-375">Este padrão é também uma [melhor prática para clusters AKS (geridos) em Azure.](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment)</span><span class="sxs-lookup"><span data-stu-id="c71e4-375">This pattern is also a [best practice for (managed) AKS clusters in Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span></span>

<span data-ttu-id="c71e4-376">O cluster Kubernetes em si, implantado através do motor AKS, deve ser composto por pelo menos três nós mestres e dois nós operários.</span><span class="sxs-lookup"><span data-stu-id="c71e4-376">The Kubernetes cluster itself, deployed via AKS Engine, should consist of at least three master nodes and two worker nodes.</span></span>

## <a name="identity-and-security-considerations"></a><span data-ttu-id="c71e4-377">Considerações de identidade e segurança</span><span class="sxs-lookup"><span data-stu-id="c71e4-377">Identity and security considerations</span></span>

<span data-ttu-id="c71e4-378">Identidade e segurança são temas importantes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-378">Identity and security are important topics.</span></span> <span data-ttu-id="c71e4-379">Especialmente quando a solução abrange instâncias independentes do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-379">Especially when the solution spans independent Azure Stack Hub instances.</span></span> <span data-ttu-id="c71e4-380">Kubernetes e Azure (incluindo O Azure Stack Hub) ambos têm mecanismos distintos para o controlo de acesso baseado em funções (RBAC):</span><span class="sxs-lookup"><span data-stu-id="c71e4-380">Kubernetes and Azure (including Azure Stack Hub) both have distinct mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="c71e4-381">O Azure RBAC controla o acesso aos recursos em Azure (e Azure Stack Hub), incluindo a capacidade de criar novos recursos Azure.</span><span class="sxs-lookup"><span data-stu-id="c71e4-381">Azure RBAC controls access to resources in Azure (and Azure Stack Hub), including the ability to create new Azure resources.</span></span> <span data-ttu-id="c71e4-382">As permissões podem ser atribuídas a utilizadores, grupos ou principais serviços.</span><span class="sxs-lookup"><span data-stu-id="c71e4-382">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="c71e4-383">(Um principal de serviço é uma identidade de segurança utilizada por aplicações.)</span><span class="sxs-lookup"><span data-stu-id="c71e4-383">(A service principal is a security identity used by applications.)</span></span>
- <span data-ttu-id="c71e4-384">Kubernetes RBAC controla permissões para a API de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-384">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="c71e4-385">Por exemplo, criar pods e cápsulas de listagem são ações que podem ser autorizadas (ou negadas) a um utilizador através do RBAC.</span><span class="sxs-lookup"><span data-stu-id="c71e4-385">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="c71e4-386">Para atribuir permissões kubernetes aos utilizadores, cria funções e encadernações de papéis.</span><span class="sxs-lookup"><span data-stu-id="c71e4-386">To assign Kubernetes permissions to users, you create roles and role bindings.</span></span>

<span data-ttu-id="c71e4-387">**Identidade do Azure Stack Hub e RBAC**</span><span class="sxs-lookup"><span data-stu-id="c71e4-387">**Azure Stack Hub identity and RBAC**</span></span>

<span data-ttu-id="c71e4-388">O Azure Stack Hub oferece duas opções de fornecedor de identidade.</span><span class="sxs-lookup"><span data-stu-id="c71e4-388">Azure Stack Hub provides two identity provider choices.</span></span> <span data-ttu-id="c71e4-389">O fornecedor que utiliza depende do ambiente e do funcionamento num ambiente ligado ou desligado:</span><span class="sxs-lookup"><span data-stu-id="c71e4-389">The provider you use depends on the environment and whether running in a connected or disconnected environment:</span></span>

- <span data-ttu-id="c71e4-390">Azure AD - só pode ser usado num ambiente conectado.</span><span class="sxs-lookup"><span data-stu-id="c71e4-390">Azure AD - can only be used in a connected environment.</span></span>
- <span data-ttu-id="c71e4-391">ADFS para uma floresta tradicional de Diretório Ativo - pode ser usado em um ambiente conectado ou desligado.</span><span class="sxs-lookup"><span data-stu-id="c71e4-391">ADFS to a traditional Active Directory forest - can be used in both a connected or disconnected environment.</span></span>

<span data-ttu-id="c71e4-392">O fornecedor de identidade gere utilizadores e grupos, incluindo a autenticação e autorização de acesso aos recursos.</span><span class="sxs-lookup"><span data-stu-id="c71e4-392">The identity provider manages users and groups, including authentication and authorization for accessing resources.</span></span> <span data-ttu-id="c71e4-393">O acesso pode ser concedido aos recursos do Azure Stack Hub, como subscrições, grupos de recursos e recursos individuais, como VMs ou equilibradores de carga.</span><span class="sxs-lookup"><span data-stu-id="c71e4-393">Access can be granted to Azure Stack Hub resources like subscriptions, resource groups, and individual resources like VMs or load balancers.</span></span> <span data-ttu-id="c71e4-394">Para ter um modelo de acesso consistente, deve considerar a utilização dos mesmos grupos (diretos ou aninhados) para todos os Azure Stack Hubs.</span><span class="sxs-lookup"><span data-stu-id="c71e4-394">To have a consistent access model, you should consider using the same groups (either direct or nested) for all Azure Stack Hubs.</span></span> <span data-ttu-id="c71e4-395">Aqui está um exemplo de configuração:</span><span class="sxs-lookup"><span data-stu-id="c71e4-395">Here's a configuration example:</span></span>

![grupos aad aninhados com hub pilha azul](media/pattern-highly-available-kubernetes/azure-stack-azure-ad-nested-groups.png)

<span data-ttu-id="c71e4-397">O exemplo contém um grupo dedicado (utilizando AAD ou ADFS) para um propósito específico.</span><span class="sxs-lookup"><span data-stu-id="c71e4-397">The example contains a dedicated group (using AAD or ADFS) for a specific purpose.</span></span> <span data-ttu-id="c71e4-398">Por exemplo, para fornecer permissões de contribuinte para o Grupo de Recursos que contém a nossa infraestrutura de cluster Kubernetes numa instância específica do Azure Stack Hub (aqui "Seattle K8s Cluster Contributor").</span><span class="sxs-lookup"><span data-stu-id="c71e4-398">For example, to provide Contributor permissions for the Resource Group that contains our Kubernetes cluster infrastructure on a specific Azure Stack Hub instance (here "Seattle K8s Cluster Contributor").</span></span> <span data-ttu-id="c71e4-399">Estes grupos são então aninhados num grupo global que contém os "subgrupos" para cada Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-399">These groups are then nested into an overall group that contains the "subgroups" for each Azure Stack Hub.</span></span>

<span data-ttu-id="c71e4-400">O nosso utilizador da amostra terá agora permissões de "Contribuinte" para ambos os Grupos de Recursos que contêm todo o conjunto de recursos de infraestrutura kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-400">Our sample user will now have "Contributor" permissions to both Resources Groups that contain the entire set of Kubernetes infrastructure resources.</span></span> <span data-ttu-id="c71e4-401">O utilizador terá acesso a recursos em ambos os casos do Azure Stack Hub, porque as instâncias partilham o mesmo fornecedor de identidade.</span><span class="sxs-lookup"><span data-stu-id="c71e4-401">The user will have access to resources on both Azure Stack Hub instances, because the instances share the same identity provider.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c71e4-402">Estas permissões afetam apenas o Azure Stack Hub e alguns dos recursos implantados em cima dele.</span><span class="sxs-lookup"><span data-stu-id="c71e4-402">These permissions affect only Azure Stack Hub and some of the resources deployed on top of it.</span></span> <span data-ttu-id="c71e4-403">Um utilizador que tenha este nível de acesso pode causar muitos danos, mas não consegue aceder aos VMs de Kubernetes nem à API de Kubernetes sem acesso adicional à implementação de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-403">A user who has this level of access can do a lot of harm, but cannot access the Kubernetes IaaS VMs nor the Kubernetes API without additional access to the Kubernetes deployment.</span></span>

<span data-ttu-id="c71e4-404">**Identidade de Kubernetes e RBAC**</span><span class="sxs-lookup"><span data-stu-id="c71e4-404">**Kubernetes identity and RBAC**</span></span>

<span data-ttu-id="c71e4-405">Um cluster Kubernetes, por padrão, não usa o mesmo Fornecedor de Identidade que o Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-405">A Kubernetes cluster, by default, doesn't use the same Identity Provider as the underlaying Azure Stack Hub.</span></span> <span data-ttu-id="c71e4-406">Os VMs que acolhem o cluster Kubernetes, o mestre e os nós dos trabalhadores, utilizam a Chave SSH que é especificada durante a implantação do cluster.</span><span class="sxs-lookup"><span data-stu-id="c71e4-406">The VMs hosting the Kubernetes cluster, the master, and worker nodes, use the SSH Key that is specified during the deployment of the cluster.</span></span> <span data-ttu-id="c71e4-407">Esta chave SSH é necessária para ligar a estes nós utilizando SSH.</span><span class="sxs-lookup"><span data-stu-id="c71e4-407">This SSH key is required to connect to these nodes using SSH.</span></span>

<span data-ttu-id="c71e4-408">A API de Kubernetes (por exemplo, acedida através da `kubectl` utilização) também está protegida por contas de serviço, incluindo uma conta de serviço "cluster administrador" por defeito.</span><span class="sxs-lookup"><span data-stu-id="c71e4-408">The Kubernetes API (for example, accessed by using `kubectl`) is also protected by service accounts including a default "cluster admin" service account.</span></span> <span data-ttu-id="c71e4-409">As credenciais desta conta de serviço são inicialmente `.kube/config` armazenadas no ficheiro nos seus nós principais Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-409">The credentials for this service account are initially stored in the `.kube/config` file on your Kubernetes master nodes.</span></span>

<span data-ttu-id="c71e4-410">**Segredos de gestão e credenciais de aplicação**</span><span class="sxs-lookup"><span data-stu-id="c71e4-410">**Secrets management and application credentials**</span></span>

<span data-ttu-id="c71e4-411">Para armazenar segredos como cadeias de ligação ou credenciais de base de dados existem várias opções, incluindo:</span><span class="sxs-lookup"><span data-stu-id="c71e4-411">To store secrets like connection strings or database credentials there are several choices, including:</span></span>

- <span data-ttu-id="c71e4-412">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="c71e4-412">Azure Key Vault</span></span>
- <span data-ttu-id="c71e4-413">Segredos de Kubernetes</span><span class="sxs-lookup"><span data-stu-id="c71e4-413">Kubernetes Secrets</span></span>
- <span data-ttu-id="c71e4-414">Soluções de 3ª Parte como o HashiCorp Vault (em execução em Kubernetes)</span><span class="sxs-lookup"><span data-stu-id="c71e4-414">3rd-Party solutions like HashiCorp Vault (running on Kubernetes)</span></span>

<span data-ttu-id="c71e4-415">Não guarde segredos ou credenciais em texto simples nos seus ficheiros de configuração, código de aplicação ou dentro de scripts.</span><span class="sxs-lookup"><span data-stu-id="c71e4-415">Do not store secrets or credentials in plaintext in your configuration files, application code, or within scripts.</span></span> <span data-ttu-id="c71e4-416">E não os guarde num sistema de controlo de versão.</span><span class="sxs-lookup"><span data-stu-id="c71e4-416">And do not store them in a version control system.</span></span> <span data-ttu-id="c71e4-417">Em vez disso, a automatização de implantação deve recuperar os segredos conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="c71e4-417">Instead, the deployment automation should retrieve the secrets as needed.</span></span>

## <a name="patch-and-update"></a><span data-ttu-id="c71e4-418">Patch e atualização</span><span class="sxs-lookup"><span data-stu-id="c71e4-418">Patch and update</span></span>

<span data-ttu-id="c71e4-419">O processo **Patch and Update (PNU)** no Serviço Azure Kubernetes é parcialmente automatizado.</span><span class="sxs-lookup"><span data-stu-id="c71e4-419">The **Patch and Update (PNU)** process in Azure Kubernetes Service is partially automated.</span></span> <span data-ttu-id="c71e4-420">As atualizações da versão Kubernetes são ativadas manualmente, enquanto as atualizações de segurança são aplicadas automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c71e4-420">Kubernetes version upgrades are triggered manually, while security updates are applied automatically.</span></span> <span data-ttu-id="c71e4-421">Estas atualizações podem incluir correções de segurança do SISTEMA ou atualizações de kernel.</span><span class="sxs-lookup"><span data-stu-id="c71e4-421">These updates can include OS security fixes or kernel updates.</span></span> <span data-ttu-id="c71e4-422">A AKS não reinicia automaticamente estes nós Linux para completar o processo de atualização.</span><span class="sxs-lookup"><span data-stu-id="c71e4-422">AKS doesn't automatically reboot these Linux nodes to complete the update process.</span></span> 

<span data-ttu-id="c71e4-423">O processo PNU para um cluster Kubernetes implantado usando o motor AKS no Azure Stack Hub não é gerido, e é da responsabilidade do operador de cluster.</span><span class="sxs-lookup"><span data-stu-id="c71e4-423">The PNU process for a Kubernetes cluster deployed using AKS Engine on Azure Stack Hub is unmanaged, and is the responsibility of the cluster operator.</span></span> 

<span data-ttu-id="c71e4-424">O Motor AKS ajuda com as duas tarefas mais importantes:</span><span class="sxs-lookup"><span data-stu-id="c71e4-424">AKS Engine helps with the two most important tasks:</span></span>

- [<span data-ttu-id="c71e4-425">Upgrade para uma versão de imagem mais recente de Kubernetes e base OS</span><span class="sxs-lookup"><span data-stu-id="c71e4-425">Upgrade to a newer Kubernetes and base OS image version</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-upgrade-to-a-newer-kubernetes-version)
- [<span data-ttu-id="c71e4-426">Atualizar apenas a imagem base do SO</span><span class="sxs-lookup"><span data-stu-id="c71e4-426">Upgrade the base OS image only</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-only-upgrade-the-os-image)

<span data-ttu-id="c71e4-427">As imagens de OS de base mais recentes contêm as mais recentes correções de segurança do SO e atualizações de kernel.</span><span class="sxs-lookup"><span data-stu-id="c71e4-427">Newer base OS images contain the latest OS security fixes and kernel updates.</span></span> 

<span data-ttu-id="c71e4-428">O mecanismo [de atualização não acompanhado](https://wiki.debian.org/UnattendedUpgrades) instala automaticamente atualizações de segurança que são lançadas antes de uma nova versão base de imagem do SO estar disponível no Azure Stack Hub Marketplace.</span><span class="sxs-lookup"><span data-stu-id="c71e4-428">The [Unattended Upgrade](https://wiki.debian.org/UnattendedUpgrades) mechanism automatically installs security updates that are released before a new base OS image version is available in the Azure Stack Hub Marketplace.</span></span> <span data-ttu-id="c71e4-429">A atualização não acompanhada é ativada por padrão e instala atualizações de segurança automaticamente, mas não reinicia os nós do cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-429">Unattended upgrade is enabled by default and installs security updates automatically, but does not reboot the Kubernetes cluster nodes.</span></span> <span data-ttu-id="c71e4-430">Reiniciar os nós pode ser automatizado utilizando a [ **K** bota **RE** **D** Aemon (kured))](/azure/aks/node-updates-kured).</span><span class="sxs-lookup"><span data-stu-id="c71e4-430">Rebooting the nodes can be automated using the open-source [**K** Ubernetes **RE** boot **D** aemon (kured))](/azure/aks/node-updates-kured).</span></span> <span data-ttu-id="c71e4-431">Relógios kured para nós Linux que requerem um reboot, em seguida, lidar automaticamente com o reagendamento de cápsulas de corrida e processo de reinicialização de nó.</span><span class="sxs-lookup"><span data-stu-id="c71e4-431">Kured watches for Linux nodes that require a reboot, then automatically handle the rescheduling of running pods and node reboot process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="c71e4-432">Considerações de implantação (CI/CD)</span><span class="sxs-lookup"><span data-stu-id="c71e4-432">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="c71e4-433">Azure e Azure Stack Hub expõem as mesmas APIs do Gestor de Recursos Azure.</span><span class="sxs-lookup"><span data-stu-id="c71e4-433">Azure and Azure Stack Hub expose the same Azure Resource Manager REST APIs.</span></span> <span data-ttu-id="c71e4-434">Estas APIs são endereçadas como qualquer outra nuvem Azure (Azure, Azure China 21Vianet, Governo Azure).</span><span class="sxs-lookup"><span data-stu-id="c71e4-434">These APIs are addressed like any other Azure cloud (Azure, Azure China 21Vianet, Azure Government).</span></span> <span data-ttu-id="c71e4-435">Pode haver diferenças nas versões API entre nuvens, e o Azure Stack Hub fornece apenas um subconjunto de serviços.</span><span class="sxs-lookup"><span data-stu-id="c71e4-435">There may be differences in API versions between clouds, and Azure Stack Hub provides only a subset of services.</span></span> <span data-ttu-id="c71e4-436">O ponto final de gestão URI também é diferente para cada nuvem, e cada instância de Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-436">The management endpoint URI is also different for each cloud, and each instance of Azure Stack Hub.</span></span>

<span data-ttu-id="c71e4-437">Além das diferenças subtis mencionadas, as APIs do Gestor de Recursos Azure fornecem uma forma consistente de interagir com o Azure e o Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-437">Aside from the subtle differences mentioned, Azure Resource Manager REST APIs provide a consistent way to interact with both Azure and Azure Stack Hub.</span></span> <span data-ttu-id="c71e4-438">O mesmo conjunto de ferramentas pode ser usado aqui como seria usado com qualquer outra nuvem Azure.</span><span class="sxs-lookup"><span data-stu-id="c71e4-438">The same set of tools can be used here as would be used with any other Azure cloud.</span></span> <span data-ttu-id="c71e4-439">Você pode usar Azure DevOps, ferramentas como Jenkins, ou PowerShell, para implementar e orquestrar serviços para Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-439">You can use Azure DevOps, tools like Jenkins, or PowerShell, to deploy and orchestrate services to Azure Stack Hub.</span></span>

<span data-ttu-id="c71e4-440">**Considerações**</span><span class="sxs-lookup"><span data-stu-id="c71e4-440">**Considerations**</span></span>

<span data-ttu-id="c71e4-441">Uma das grandes diferenças no que diz respeito às implementações do Azure Stack Hub é a questão da acessibilidade à Internet.</span><span class="sxs-lookup"><span data-stu-id="c71e4-441">One of the major differences when it comes to Azure Stack Hub deployments is the question of Internet accessibility.</span></span> <span data-ttu-id="c71e4-442">A acessibilidade à Internet determina se seleciona um agente de construção hospedado na Microsoft ou um agente de construção auto-hospedado para os seus trabalhos de CI/CD.</span><span class="sxs-lookup"><span data-stu-id="c71e4-442">Internet accessibility determines whether to select a Microsoft-hosted or a self-hosted build agent for your CI/CD jobs.</span></span>

<span data-ttu-id="c71e4-443">Um agente auto-hospedado pode funcionar em cima do Azure Stack Hub (como um IaaS VM) ou numa sub-rede de rede que pode aceder ao Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-443">A self-hosted agent can run on top of Azure Stack Hub (as an IaaS VM) or in a network subnet that can access Azure Stack Hub.</span></span> <span data-ttu-id="c71e4-444">Vá aos [agentes da Azure Pipelines](/azure/devops/pipelines/agents/agents) para saber mais sobre as diferenças.</span><span class="sxs-lookup"><span data-stu-id="c71e4-444">Go to [Azure Pipelines agents](/azure/devops/pipelines/agents/agents) to learn more about the differences.</span></span>

<span data-ttu-id="c71e4-445">A imagem a seguir ajuda-o a decidir se precisa de um agente de construção auto-hospedado ou hospedado na Microsoft:</span><span class="sxs-lookup"><span data-stu-id="c71e4-445">The following image helps you to decide if you need a self-hosted or a Microsoft-hosted build agent:</span></span>

![Agentes de construção auto-hospedados Sim ou Não](media/pattern-highly-available-kubernetes/aks-on-stack-self-hosted-build-agents-yes-or-no.png)

- <span data-ttu-id="c71e4-447">Os pontos finais de gestão do Azure Stack Hub estão acessíveis via Internet?</span><span class="sxs-lookup"><span data-stu-id="c71e4-447">Are the Azure Stack Hub management endpoints accessible via Internet?</span></span>
  - <span data-ttu-id="c71e4-448">Sim: Podemos usar Azure Pipelines com agentes hospedados pela Microsoft para ligar ao Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-448">Yes: We can use Azure Pipelines with Microsoft-hosted agents to connect to Azure Stack Hub.</span></span>
  - <span data-ttu-id="c71e4-449">Não: Precisamos de agentes auto-hospedados que possam ligar-se aos pontos finais de gestão do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-449">No: We need self-hosted agents that can connect to Azure Stack Hub's management endpoints.</span></span>
- <span data-ttu-id="c71e4-450">O nosso cluster Kubernetes está acessível através da Internet?</span><span class="sxs-lookup"><span data-stu-id="c71e4-450">Is our Kubernetes cluster accessible via the Internet?</span></span>
  - <span data-ttu-id="c71e4-451">Sim: Podemos usar Azure Pipelines com agentes hospedados pela Microsoft para interagir diretamente com o ponto final da API da Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-451">Yes: We can use Azure Pipelines with Microsoft-hosted agents to interact directly with Kubernetes API endpoint.</span></span>
  - <span data-ttu-id="c71e4-452">Não: Precisamos de agentes auto-hospedados que possam ligar-se ao ponto final da API do cluster Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-452">No: We need self-hosted Agents that can connect to the Kubernetes cluster API endpoint.</span></span>

<span data-ttu-id="c71e4-453">Em cenários em que os pontos finais de gestão do Azure Stack Hub e da API de Kubernetes estão acessíveis através da internet, a implementação pode utilizar um agente hospedado pela Microsoft.</span><span class="sxs-lookup"><span data-stu-id="c71e4-453">In scenarios where the Azure Stack Hub management endpoints and Kubernetes API are accessible via the internet, the deployment can use a Microsoft-hosted agent.</span></span> <span data-ttu-id="c71e4-454">Esta implementação resultará numa arquitetura de aplicações da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="c71e4-454">This deployment will result in an application architecture as follows:</span></span>

<span data-ttu-id="c71e4-455">[![Visão geral da arquitetura pública](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="c71e4-455">[![Public architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span></span>

<span data-ttu-id="c71e4-456">Se o Gestor de Recursos Azure, a API de Kubernetes, ou ambos não estiverem diretamente acessíveis através da Internet, podemos aproveitar um agente de construção auto-hospedado para executar os passos do pipeline.</span><span class="sxs-lookup"><span data-stu-id="c71e4-456">If the Azure Resource Manager endpoints, Kubernetes API, or both aren't directly accessible via the Internet, we can leverage a self-hosted build agent to run the pipeline steps.</span></span> <span data-ttu-id="c71e4-457">Este design necessita de menos conectividade, e pode ser implementado apenas com conectividade de rede no local para pontos finais do Azure Resource Manager e da API de Kubernetes:</span><span class="sxs-lookup"><span data-stu-id="c71e4-457">This design needs less connectivity, and can be deployed with only on-premises network connectivity to Azure Resource Manager endpoints and the Kubernetes API:</span></span>

<span data-ttu-id="c71e4-458">[![Visão geral da arquitetura on-prem](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="c71e4-458">[![On-prem architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span></span>

> [!NOTE]
> <span data-ttu-id="c71e4-459">**E cenários desligados?**</span><span class="sxs-lookup"><span data-stu-id="c71e4-459">**What about disconnected scenarios?**</span></span> <span data-ttu-id="c71e4-460">Em cenários em que o Azure Stack Hub ou o Kubernetes ou ambos não têm pontos finais de gestão virados para a Internet, ainda é possível utilizar o Azure DevOps para as suas implementações.</span><span class="sxs-lookup"><span data-stu-id="c71e4-460">In scenarios where either Azure Stack Hub or Kubernetes or both of them do not have internet-facing management endpoints, it is still possible to use Azure DevOps for your deployments.</span></span> <span data-ttu-id="c71e4-461">Você pode usar um Agent Pool auto-hospedado (que é um Agente DevOps que está correndo no local ou no próprio Azure Stack Hub) ou um Azure DevOps Server completamente auto-hospedado no local.</span><span class="sxs-lookup"><span data-stu-id="c71e4-461">You can either use a self-hosted Agent Pool (which is a DevOps Agent running on-premises or on Azure Stack Hub itself) or a completly self-hosted Azure DevOps Server on-premises.</span></span> <span data-ttu-id="c71e4-462">O agente auto-alojado necessita apenas de conectividade de saída HTTPS (TCP/443) na Internet.</span><span class="sxs-lookup"><span data-stu-id="c71e4-462">The self-hosted agent needs only outbound HTTPS (TCP/443) Internet connectivity.</span></span>

<span data-ttu-id="c71e4-463">O padrão pode usar um cluster Kubernetes (implantado e orquestrado com motor AKS) em cada instância do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-463">The pattern can use a Kubernetes cluster (deployed and orchestrated with AKS engine) on each Azure Stack Hub instance.</span></span> <span data-ttu-id="c71e4-464">Inclui uma aplicação composta por um frontend, um serviço de backend de nível médio (por exemplo, MongoDB), e um Controlador ingress baseado em Nginx.</span><span class="sxs-lookup"><span data-stu-id="c71e4-464">It includes an application consisting of a frontend, a mid-tier, backend services (for example MongoDB), and an nginx-based Ingress Controller.</span></span> <span data-ttu-id="c71e4-465">Em vez de utilizar uma base de dados hospedada no cluster K8s, pode aproveitar as "lojas de dados externas".</span><span class="sxs-lookup"><span data-stu-id="c71e4-465">Instead of using a database hosted on the K8s cluster, you can leverage "external data stores".</span></span> <span data-ttu-id="c71e4-466">As opções de base de dados incluem MySQL, SQL Server ou qualquer tipo de base de dados hospedada fora do Azure Stack Hub ou em IaaS.</span><span class="sxs-lookup"><span data-stu-id="c71e4-466">Database options include MySQL, SQL Server, or any kind of database hosted outside of Azure Stack Hub or in IaaS.</span></span> <span data-ttu-id="c71e4-467">Configurações como esta não estão no âmbito aqui.</span><span class="sxs-lookup"><span data-stu-id="c71e4-467">Configurations like this aren't in scope here.</span></span>

## <a name="partner-solutions"></a><span data-ttu-id="c71e4-468">Soluções de parceiros</span><span class="sxs-lookup"><span data-stu-id="c71e4-468">Partner solutions</span></span>

<span data-ttu-id="c71e4-469">Existem soluções Microsoft Partner que podem alargar as capacidades do Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-469">There are Microsoft Partner solutions that can extend the capabilities of Azure Stack Hub.</span></span> <span data-ttu-id="c71e4-470">Estas soluções foram consideradas úteis nas implementações de aplicações em execução em clusters Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-470">These solutions have been found useful in deployments of applications running on Kubernetes clusters.</span></span>  

## <a name="storage-and-data-solutions"></a><span data-ttu-id="c71e4-471">Soluções de armazenamento e dados</span><span class="sxs-lookup"><span data-stu-id="c71e4-471">Storage and data solutions</span></span>

<span data-ttu-id="c71e4-472">Como descrito em [considerações de Dados e armazenamento,](#data-and-storage-considerations)a Azure Stack Hub atualmente não tem uma solução nativa para replicar armazenamento em várias instâncias.</span><span class="sxs-lookup"><span data-stu-id="c71e4-472">As described in [Data and storage considerations](#data-and-storage-considerations), Azure Stack Hub currently doesn't have a native solution to replicate storage across multiple instances.</span></span> <span data-ttu-id="c71e4-473">Ao contrário do Azure, a capacidade de replicar o armazenamento em várias regiões não existe.</span><span class="sxs-lookup"><span data-stu-id="c71e4-473">Unlike Azure, the capability of replicating storage across multiple regions does not exist.</span></span> <span data-ttu-id="c71e4-474">Em Azure Stack Hub, cada instância é a sua própria nuvem distinta.</span><span class="sxs-lookup"><span data-stu-id="c71e4-474">In Azure Stack Hub, each instance is its own distinct cloud.</span></span> <span data-ttu-id="c71e4-475">No entanto, existem soluções disponíveis a partir de Microsoft Partners que permitem a replicação de armazenamento através do Azure Stack Hubs e do Azure.</span><span class="sxs-lookup"><span data-stu-id="c71e4-475">However, solutions are available from Microsoft Partners that enable storage replication across Azure Stack Hubs and Azure.</span></span> 

<span data-ttu-id="c71e4-476">**ESCALIDADE**</span><span class="sxs-lookup"><span data-stu-id="c71e4-476">**SCALITY**</span></span>

<span data-ttu-id="c71e4-477">[A Scality](https://www.scality.com/) oferece armazenamento em escala web que alimenta empresas digitais desde 2009.</span><span class="sxs-lookup"><span data-stu-id="c71e4-477">[Scality](https://www.scality.com/) delivers web-scale storage that has powered digital businesses since 2009.</span></span> <span data-ttu-id="c71e4-478">O Scality RING, o nosso armazenamento definido por software, transforma os servidores de mercadoria x86 num conjunto de armazenamento ilimitado para qualquer tipo de dados – ficheiro e objeto – à escala de petabyte.</span><span class="sxs-lookup"><span data-stu-id="c71e4-478">The Scality RING, our software-defined storage, turns commodity x86 servers into an unlimited storage pool for any type of data –file and object– at petabyte scale.</span></span>

<span data-ttu-id="c71e4-479">**CLOUDIAN**</span><span class="sxs-lookup"><span data-stu-id="c71e4-479">**CLOUDIAN**</span></span>

<span data-ttu-id="c71e4-480">[O Cloudian](https://www.cloudian.com/) simplifica o armazenamento da empresa com armazenamento escalável ilimitado que consolida conjuntos de dados maciços para um ambiente único e facilmente gerido.</span><span class="sxs-lookup"><span data-stu-id="c71e4-480">[Cloudian](https://www.cloudian.com/) simplifies enterprise storage with limitless scalable storage that consolidates massive data sets to a single, easily managed environment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c71e4-481">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="c71e4-481">Next steps</span></span>

<span data-ttu-id="c71e4-482">Para saber mais sobre conceitos introduzidos neste artigo:</span><span class="sxs-lookup"><span data-stu-id="c71e4-482">To learn more about concepts introduced in this article:</span></span>

- <span data-ttu-id="c71e4-483">[Escalas cruzadas](pattern-cross-cloud-scale.md) e [padrões de aplicativos geo-distribuídos](pattern-geo-distributed.md) no Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="c71e4-483">[Cross-cloud scaling](pattern-cross-cloud-scale.md) and [Geo-distributed app patterns](pattern-geo-distributed.md) in Azure Stack Hub.</span></span>
- <span data-ttu-id="c71e4-484">[Microserviços arquitetura em Azure Kubernetes Service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span><span class="sxs-lookup"><span data-stu-id="c71e4-484">[Microservices architecture on Azure Kubernetes Service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span></span>

<span data-ttu-id="c71e4-485">Quando estiver pronto para testar o exemplo da solução, continue com o guia de implantação do [cluster Kubernetes](solution-deployment-guide-highly-available-kubernetes.md)de alta disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="c71e4-485">When you're ready to test the solution example, continue with the [High availability Kubernetes cluster deployment guide](solution-deployment-guide-highly-available-kubernetes.md).</span></span> <span data-ttu-id="c71e4-486">O guia de implantação fornece instruções passo a passo para a implantação e teste dos seus componentes.</span><span class="sxs-lookup"><span data-stu-id="c71e4-486">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>